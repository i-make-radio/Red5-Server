!function e(t,n,i){function r(s,c){if(!n[s]){if(!t[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var h=n[s]={exports:{}};t[s][0].call(h.exports,function(e){var n=t[s][1][e];return r(n?n:e)},h,h.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t,n){function i(){this.buffer=[]}function r(e){this._input=e,this._index=-1,this._buffer=[]}function o(e){this._input=e,this._index=-1,this._buffer=[]}i.prototype.append=function(e){return this.buffer.push(e),this},i.prototype.toString=function(){return this.buffer.join("")};var s={codex:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){for(var t=new i,n=new r(e);n.moveNext();){var o=n.current;n.moveNext();var s=n.current;n.moveNext();var c=n.current,a=o>>2,u=(3&o)<<4|s>>4,h=(15&s)<<2|c>>6,d=63&c;isNaN(s)?h=d=64:isNaN(c)&&(d=64),t.append(this.codex.charAt(a)+this.codex.charAt(u)+this.codex.charAt(h)+this.codex.charAt(d))}return t.toString()},decode:function(e){for(var t=new i,n=new o(e);n.moveNext();){var r=n.current;if(128>r)t.append(String.fromCharCode(r));else if(r>191&&224>r){n.moveNext();var s=n.current;t.append(String.fromCharCode((31&r)<<6|63&s))}else{n.moveNext();var s=n.current;n.moveNext();var c=n.current;t.append(String.fromCharCode((15&r)<<12|(63&s)<<6|63&c))}}return t.toString()}};r.prototype={current:Number.NaN,moveNext:function(){if(this._buffer.length>0)return this.current=this._buffer.shift(),!0;if(this._index>=this._input.length-1)return this.current=Number.NaN,!1;var e=this._input.charCodeAt(++this._index);return 13==e&&10==this._input.charCodeAt(this._index+1)&&(e=10,this._index+=2),128>e?this.current=e:e>127&&2048>e?(this.current=e>>6|192,this._buffer.push(63&e|128)):(this.current=e>>12|224,this._buffer.push(e>>6&63|128),this._buffer.push(63&e|128)),!0}},o.prototype={current:64,moveNext:function(){if(this._buffer.length>0)return this.current=this._buffer.shift(),!0;if(this._index>=this._input.length-1)return this.current=64,!1;var e=s.codex.indexOf(this._input.charAt(++this._index)),t=s.codex.indexOf(this._input.charAt(++this._index)),n=s.codex.indexOf(this._input.charAt(++this._index)),i=s.codex.indexOf(this._input.charAt(++this._index)),r=e<<2|t>>4,o=(15&t)<<4|n>>2,c=(3&n)<<6|i;return this.current=r,64!=n&&this._buffer.push(o),64!=i&&this._buffer.push(c),!0}},t.exports=s},{}],2:[function(e,t,n){},{}],3:[function(e,t,n){(function(t){function i(){function e(){}try{var t=new Uint8Array(1);return t.foo=function(){return 42},t.constructor=e,42===t.foo()&&t.constructor===e&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(n){return!1}}function r(){return o.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e){return this instanceof o?(this.length=0,this.parent=void 0,"number"==typeof e?s(this,e):"string"==typeof e?c(this,e,arguments.length>1?arguments[1]:"utf8"):a(this,e)):arguments.length>1?new o(e,arguments[1]):new o(e)}function s(e,t){if(e=p(e,0>t?0:0|v(t)),!o.TYPED_ARRAY_SUPPORT)for(var n=0;t>n;n++)e[n]=0;return e}function c(e,t,n){("string"!=typeof n||""===n)&&(n="utf8");var i=0|m(t,n);return e=p(e,i),e.write(t,n),e}function a(e,t){if(o.isBuffer(t))return u(e,t);if(X(t))return h(e,t);if(null==t)throw new TypeError("must start with number, buffer, array or string");if("undefined"!=typeof ArrayBuffer){if(t.buffer instanceof ArrayBuffer)return d(e,t);if(t instanceof ArrayBuffer)return l(e,t)}return t.length?f(e,t):g(e,t)}function u(e,t){var n=0|v(t.length);return e=p(e,n),t.copy(e,0,0,n),e}function h(e,t){var n=0|v(t.length);e=p(e,n);for(var i=0;n>i;i+=1)e[i]=255&t[i];return e}function d(e,t){var n=0|v(t.length);e=p(e,n);for(var i=0;n>i;i+=1)e[i]=255&t[i];return e}function l(e,t){return o.TYPED_ARRAY_SUPPORT?(t.byteLength,e=o._augment(new Uint8Array(t))):e=d(e,new Uint8Array(t)),e}function f(e,t){var n=0|v(t.length);e=p(e,n);for(var i=0;n>i;i+=1)e[i]=255&t[i];return e}function g(e,t){var n,i=0;"Buffer"===t.type&&X(t.data)&&(n=t.data,i=0|v(n.length)),e=p(e,i);for(var r=0;i>r;r+=1)e[r]=255&n[r];return e}function p(e,t){o.TYPED_ARRAY_SUPPORT?(e=o._augment(new Uint8Array(t)),e.__proto__=o.prototype):(e.length=t,e._isBuffer=!0);var n=0!==t&&t<=o.poolSize>>>1;return n&&(e.parent=Q),e}function v(e){if(e>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|e}function E(e,t){if(!(this instanceof E))return new E(e,t);var n=new o(e,t);return delete n.parent,n}function m(e,t){"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"binary":case"raw":case"raws":return n;case"utf8":case"utf-8":return j(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return z(e).length;default:if(i)return j(e).length;t=(""+t).toLowerCase(),i=!0}}function y(e,t,n){var i=!1;if(t=0|t,n=void 0===n||n===1/0?this.length:0|n,e||(e="utf8"),0>t&&(t=0),n>this.length&&(n=this.length),t>=n)return"";for(;;)switch(e){case"hex":return N(this,t,n);case"utf8":case"utf-8":return D(this,t,n);case"ascii":return _(this,t,n);case"binary":return O(this,t,n);case"base64":return R(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function I(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i),i>r&&(i=r)):i=r;var o=t.length;if(o%2!==0)throw new Error("Invalid hex string");i>o/2&&(i=o/2);for(var s=0;i>s;s++){var c=parseInt(t.substr(2*s,2),16);if(isNaN(c))throw new Error("Invalid hex string");e[n+s]=c}return s}function b(e,t,n,i){return K(j(t,e.length-n),e,n,i)}function C(e,t,n,i){return K(G(t),e,n,i)}function w(e,t,n,i){return C(e,t,n,i)}function S(e,t,n,i){return K(z(t),e,n,i)}function A(e,t,n,i){return K(W(t,e.length-n),e,n,i)}function R(e,t,n){return 0===t&&n===e.length?q.fromByteArray(e):q.fromByteArray(e.slice(t,n))}function D(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;n>r;){var o=e[r],s=null,c=o>239?4:o>223?3:o>191?2:1;if(n>=r+c){var a,u,h,d;switch(c){case 1:128>o&&(s=o);break;case 2:a=e[r+1],128===(192&a)&&(d=(31&o)<<6|63&a,d>127&&(s=d));break;case 3:a=e[r+1],u=e[r+2],128===(192&a)&&128===(192&u)&&(d=(15&o)<<12|(63&a)<<6|63&u,d>2047&&(55296>d||d>57343)&&(s=d));break;case 4:a=e[r+1],u=e[r+2],h=e[r+3],128===(192&a)&&128===(192&u)&&128===(192&h)&&(d=(15&o)<<18|(63&a)<<12|(63&u)<<6|63&h,d>65535&&1114112>d&&(s=d))}}null===s?(s=65533,c=1):s>65535&&(s-=65536,i.push(s>>>10&1023|55296),s=56320|1023&s),i.push(s),r+=c}return T(i)}function T(e){var t=e.length;if(Z>=t)return String.fromCharCode.apply(String,e);for(var n="",i=0;t>i;)n+=String.fromCharCode.apply(String,e.slice(i,i+=Z));return n}function _(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;n>r;r++)i+=String.fromCharCode(127&e[r]);return i}function O(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;n>r;r++)i+=String.fromCharCode(e[r]);return i}function N(e,t,n){var i=e.length;(!t||0>t)&&(t=0),(!n||0>n||n>i)&&(n=i);for(var r="",o=t;n>o;o++)r+=Y(e[o]);return r}function M(e,t,n){for(var i=e.slice(t,n),r="",o=0;o<i.length;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}function x(e,t,n){if(e%1!==0||0>e)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function L(e,t,n,i,r,s){if(!o.isBuffer(e))throw new TypeError("buffer must be a Buffer instance");if(t>r||s>t)throw new RangeError("value is out of bounds");if(n+i>e.length)throw new RangeError("index out of range")}function U(e,t,n,i){0>t&&(t=65535+t+1);for(var r=0,o=Math.min(e.length-n,2);o>r;r++)e[n+r]=(t&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function P(e,t,n,i){0>t&&(t=4294967295+t+1);for(var r=0,o=Math.min(e.length-n,4);o>r;r++)e[n+r]=t>>>8*(i?r:3-r)&255}function k(e,t,n,i,r,o){if(t>r||o>t)throw new RangeError("value is out of bounds");if(n+i>e.length)throw new RangeError("index out of range");if(0>n)throw new RangeError("index out of range")}function B(e,t,n,i,r){return r||k(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),J.write(e,t,n,i,23,4),n+4}function V(e,t,n,i,r){return r||k(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),J.write(e,t,n,i,52,8),n+8}function F(e){if(e=H(e).replace(ee,""),e.length<2)return"";for(;e.length%4!==0;)e+="=";return e}function H(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Y(e){return 16>e?"0"+e.toString(16):e.toString(16)}function j(e,t){t=t||1/0;for(var n,i=e.length,r=null,o=[],s=0;i>s;s++){if(n=e.charCodeAt(s),n>55295&&57344>n){if(!r){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===i){(t-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(56320>n){(t-=3)>-1&&o.push(239,191,189),r=n;continue}n=r-55296<<10|n-56320|65536}else r&&(t-=3)>-1&&o.push(239,191,189);if(r=null,128>n){if((t-=1)<0)break;o.push(n)}else if(2048>n){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(65536>n){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(1114112>n))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function G(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t}function W(e,t){for(var n,i,r,o=[],s=0;s<e.length&&!((t-=2)<0);s++)n=e.charCodeAt(s),i=n>>8,r=n%256,o.push(r),o.push(i);return o}function z(e){return q.toByteArray(F(e))}function K(e,t,n,i){for(var r=0;i>r&&!(r+n>=t.length||r>=e.length);r++)t[r+n]=e[r];return r}var q=e("base64-js"),J=e("ieee754"),X=e("is-array");n.Buffer=o,n.SlowBuffer=E,n.INSPECT_MAX_BYTES=50,o.poolSize=8192;var Q={};o.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:i(),o.TYPED_ARRAY_SUPPORT&&(o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array),o.isBuffer=function(e){return!(null==e||!e._isBuffer)},o.compare=function(e,t){if(!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,r=0,s=Math.min(n,i);s>r&&e[r]===t[r];)++r;return r!==s&&(n=e[r],i=t[r]),i>n?-1:n>i?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!X(e))throw new TypeError("list argument must be an Array of Buffers.");if(0===e.length)return new o(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;n++)t+=e[n].length;var i=new o(t),r=0;for(n=0;n<e.length;n++){var s=e[n];s.copy(i,r),r+=s.length}return i},o.byteLength=m,o.prototype.length=void 0,o.prototype.parent=void 0,o.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?D(this,0,e):y.apply(this,arguments)},o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:0===o.compare(this,e)},o.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},o.prototype.compare=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?0:o.compare(this,e)},o.prototype.indexOf=function(e,t){function n(e,t,n){for(var i=-1,r=0;n+r<e.length;r++)if(e[n+r]===t[-1===i?0:r-i]){if(-1===i&&(i=r),r-i+1===t.length)return n+i}else i=-1;return-1}if(t>2147483647?t=2147483647:-2147483648>t&&(t=-2147483648),t>>=0,0===this.length)return-1;if(t>=this.length)return-1;if(0>t&&(t=Math.max(this.length+t,0)),"string"==typeof e)return 0===e.length?-1:String.prototype.indexOf.call(this,e,t);if(o.isBuffer(e))return n(this,e,t);if("number"==typeof e)return o.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,e,t):n(this,[e],t);throw new TypeError("val must be string, number or Buffer")},o.prototype.get=function(e){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(e)},o.prototype.set=function(e,t){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(e,t)},o.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else if(isFinite(t))t=0|t,isFinite(n)?(n=0|n,void 0===i&&(i="utf8")):(i=n,n=void 0);else{var r=i;i=t,t=0|n,n=r}var o=this.length-t;if((void 0===n||n>o)&&(n=o),e.length>0&&(0>n||0>t)||t>this.length)throw new RangeError("attempt to write outside buffer bounds");i||(i="utf8");for(var s=!1;;)switch(i){case"hex":return I(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":return C(this,e,t,n);case"binary":return w(this,e,t,n);case"base64":return S(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),s=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Z=4096;o.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,0>e?(e+=n,0>e&&(e=0)):e>n&&(e=n),0>t?(t+=n,0>t&&(t=0)):t>n&&(t=n),e>t&&(t=e);var i;if(o.TYPED_ARRAY_SUPPORT)i=o._augment(this.subarray(e,t));else{var r=t-e;i=new o(r,void 0);for(var s=0;r>s;s++)i[s]=this[s+e]}return i.length&&(i.parent=this.parent||this),i},o.prototype.readUIntLE=function(e,t,n){e=0|e,t=0|t,n||x(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i},o.prototype.readUIntBE=function(e,t,n){e=0|e,t=0|t,n||x(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},o.prototype.readUInt8=function(e,t){return t||x(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return t||x(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return t||x(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return t||x(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,t){return t||x(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,n){e=0|e,t=0|t,n||x(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return r*=128,i>=r&&(i-=Math.pow(2,8*t)),i},o.prototype.readIntBE=function(e,t,n){e=0|e,t=0|t,n||x(e,t,this.length);for(var i=t,r=1,o=this[e+--i];i>0&&(r*=256);)o+=this[e+--i]*r;return r*=128,o>=r&&(o-=Math.pow(2,8*t)),o},o.prototype.readInt8=function(e,t){return t||x(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,t){t||x(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt16BE=function(e,t){t||x(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt32LE=function(e,t){return t||x(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return t||x(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return t||x(e,4,this.length),J.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return t||x(e,4,this.length),J.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return t||x(e,8,this.length),J.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return t||x(e,8,this.length),J.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,n,i){e=+e,t=0|t,n=0|n,i||L(this,e,t,n,Math.pow(2,8*n),0);var r=1,o=0;for(this[t]=255&e;++o<n&&(r*=256);)this[t+o]=e/r&255;return t+n},o.prototype.writeUIntBE=function(e,t,n,i){e=+e,t=0|t,n=0|n,i||L(this,e,t,n,Math.pow(2,8*n),0);var r=n-1,o=1;for(this[t+r]=255&e;--r>=0&&(o*=256);)this[t+r]=e/o&255;return t+n},o.prototype.writeUInt8=function(e,t,n){return e=+e,t=0|t,n||L(this,e,t,1,255,0),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,n){return e=+e,t=0|t,n||L(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):U(this,e,t,!0),t+2},o.prototype.writeUInt16BE=function(e,t,n){return e=+e,t=0|t,n||L(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):U(this,e,t,!1),t+2},o.prototype.writeUInt32LE=function(e,t,n){return e=+e,t=0|t,n||L(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):P(this,e,t,!0),t+4},o.prototype.writeUInt32BE=function(e,t,n){return e=+e,t=0|t,n||L(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},o.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t=0|t,!i){var r=Math.pow(2,8*n-1);L(this,e,t,n,r-1,-r)}var o=0,s=1,c=0>e?1:0;for(this[t]=255&e;++o<n&&(s*=256);)this[t+o]=(e/s>>0)-c&255;return t+n},o.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t=0|t,!i){var r=Math.pow(2,8*n-1);L(this,e,t,n,r-1,-r)}var o=n-1,s=1,c=0>e?1:0;for(this[t+o]=255&e;--o>=0&&(s*=256);)this[t+o]=(e/s>>0)-c&255;return t+n},o.prototype.writeInt8=function(e,t,n){return e=+e,t=0|t,n||L(this,e,t,1,127,-128),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),0>e&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,n){return e=+e,t=0|t,n||L(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):U(this,e,t,!0),t+2},o.prototype.writeInt16BE=function(e,t,n){return e=+e,t=0|t,n||L(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):U(this,e,t,!1),t+2},o.prototype.writeInt32LE=function(e,t,n){return e=+e,t=0|t,n||L(this,e,t,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):P(this,e,t,!0),t+4},o.prototype.writeInt32BE=function(e,t,n){return e=+e,t=0|t,n||L(this,e,t,4,2147483647,-2147483648),0>e&&(e=4294967295+e+1),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},o.prototype.writeFloatLE=function(e,t,n){return B(this,e,t,!0,n)},o.prototype.writeFloatBE=function(e,t,n){return B(this,e,t,!1,n)},o.prototype.writeDoubleLE=function(e,t,n){return V(this,e,t,!0,n)},o.prototype.writeDoubleBE=function(e,t,n){return V(this,e,t,!1,n)},o.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&n>i&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(0>t)throw new RangeError("targetStart out of bounds");if(0>n||n>=this.length)throw new RangeError("sourceStart out of bounds");if(0>i)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r,s=i-n;if(this===e&&t>n&&i>t)for(r=s-1;r>=0;r--)e[r+t]=this[r+n];else if(1e3>s||!o.TYPED_ARRAY_SUPPORT)for(r=0;s>r;r++)e[r+t]=this[r+n];else e._set(this.subarray(n,n+s),t);return s},o.prototype.fill=function(e,t,n){if(e||(e=0),t||(t=0),n||(n=this.length),t>n)throw new RangeError("end < start");if(n!==t&&0!==this.length){if(0>t||t>=this.length)throw new RangeError("start out of bounds");if(0>n||n>this.length)throw new RangeError("end out of bounds");var i;if("number"==typeof e)for(i=t;n>i;i++)this[i]=e;else{var r=j(e.toString()),o=r.length;for(i=t;n>i;i++)this[i]=r[i%o]}return this}},o.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(o.TYPED_ARRAY_SUPPORT)return new o(this).buffer;for(var e=new Uint8Array(this.length),t=0,n=e.length;n>t;t+=1)e[t]=this[t];return e.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var $=o.prototype;o._augment=function(e){return e.constructor=o,e._isBuffer=!0,e._set=e.set,e.get=$.get,e.set=$.set,e.write=$.write,e.toString=$.toString,e.toLocaleString=$.toString,e.toJSON=$.toJSON,e.equals=$.equals,e.compare=$.compare,e.indexOf=$.indexOf,e.copy=$.copy,e.slice=$.slice,e.readUIntLE=$.readUIntLE,e.readUIntBE=$.readUIntBE,e.readUInt8=$.readUInt8,e.readUInt16LE=$.readUInt16LE,e.readUInt16BE=$.readUInt16BE,e.readUInt32LE=$.readUInt32LE,e.readUInt32BE=$.readUInt32BE,e.readIntLE=$.readIntLE,e.readIntBE=$.readIntBE,e.readInt8=$.readInt8,e.readInt16LE=$.readInt16LE,e.readInt16BE=$.readInt16BE,e.readInt32LE=$.readInt32LE,e.readInt32BE=$.readInt32BE,e.readFloatLE=$.readFloatLE,e.readFloatBE=$.readFloatBE,e.readDoubleLE=$.readDoubleLE,e.readDoubleBE=$.readDoubleBE,e.writeUInt8=$.writeUInt8,e.writeUIntLE=$.writeUIntLE,e.writeUIntBE=$.writeUIntBE,e.writeUInt16LE=$.writeUInt16LE,e.writeUInt16BE=$.writeUInt16BE,e.writeUInt32LE=$.writeUInt32LE,e.writeUInt32BE=$.writeUInt32BE,e.writeIntLE=$.writeIntLE,e.writeIntBE=$.writeIntBE,e.writeInt8=$.writeInt8,e.writeInt16LE=$.writeInt16LE,e.writeInt16BE=$.writeInt16BE,e.writeInt32LE=$.writeInt32LE,e.writeInt32BE=$.writeInt32BE,e.writeFloatLE=$.writeFloatLE,e.writeFloatBE=$.writeFloatBE,e.writeDoubleLE=$.writeDoubleLE,e.writeDoubleBE=$.writeDoubleBE,e.fill=$.fill,e.inspect=$.inspect,e.toArrayBuffer=$.toArrayBuffer,e};var ee=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":4,ieee754:5,"is-array":6}],4:[function(e,t,n){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(e){"use strict";function t(e){var t=e.charCodeAt(0);return t===s||t===d?62:t===c||t===l?63:a>t?-1:a+10>t?t-a+26+26:h+26>t?t-h:u+26>t?t-u+26:void 0}function n(e){function n(e){u[d++]=e}var i,r,s,c,a,u;if(e.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var h=e.length;a="="===e.charAt(h-2)?2:"="===e.charAt(h-1)?1:0,u=new o(3*e.length/4-a),s=a>0?e.length-4:e.length;var d=0;for(i=0,r=0;s>i;i+=4,r+=3)c=t(e.charAt(i))<<18|t(e.charAt(i+1))<<12|t(e.charAt(i+2))<<6|t(e.charAt(i+3)),n((16711680&c)>>16),n((65280&c)>>8),n(255&c);return 2===a?(c=t(e.charAt(i))<<2|t(e.charAt(i+1))>>4,n(255&c)):1===a&&(c=t(e.charAt(i))<<10|t(e.charAt(i+1))<<4|t(e.charAt(i+2))>>2,n(c>>8&255),n(255&c)),u}function r(e){function t(e){return i.charAt(e)}function n(e){return t(e>>18&63)+t(e>>12&63)+t(e>>6&63)+t(63&e)}var r,o,s,c=e.length%3,a="";for(r=0,s=e.length-c;s>r;r+=3)o=(e[r]<<16)+(e[r+1]<<8)+e[r+2],a+=n(o);switch(c){case 1:o=e[e.length-1],a+=t(o>>2),a+=t(o<<4&63),a+="==";break;case 2:o=(e[e.length-2]<<8)+e[e.length-1],a+=t(o>>10),a+=t(o>>4&63),a+=t(o<<2&63),a+="="}return a}var o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="+".charCodeAt(0),c="/".charCodeAt(0),a="0".charCodeAt(0),u="a".charCodeAt(0),h="A".charCodeAt(0),d="-".charCodeAt(0),l="_".charCodeAt(0);e.toByteArray=n,e.fromByteArray=r}("undefined"==typeof n?this.base64js={}:n)},{}],5:[function(e,t,n){n.read=function(e,t,n,i,r){var o,s,c=8*r-i-1,a=(1<<c)-1,u=a>>1,h=-7,d=n?r-1:0,l=n?-1:1,f=e[t+d];for(d+=l,o=f&(1<<-h)-1,f>>=-h,h+=c;h>0;o=256*o+e[t+d],d+=l,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=i;h>0;s=256*s+e[t+d],d+=l,h-=8);if(0===o)o=1-u;else{if(o===a)return s?NaN:(f?-1:1)*(1/0);s+=Math.pow(2,i),o-=u}return(f?-1:1)*s*Math.pow(2,o-i)},n.write=function(e,t,n,i,r,o){var s,c,a,u=8*o-r-1,h=(1<<u)-1,d=h>>1,l=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:o-1,g=i?1:-1,p=0>t||0===t&&0>1/t?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(c=isNaN(t)?1:0,s=h):(s=Math.floor(Math.log(t)/Math.LN2),t*(a=Math.pow(2,-s))<1&&(s--,a*=2),t+=s+d>=1?l/a:l*Math.pow(2,1-d),t*a>=2&&(s++,a/=2),s+d>=h?(c=0,s=h):s+d>=1?(c=(t*a-1)*Math.pow(2,r),s+=d):(c=t*Math.pow(2,d-1)*Math.pow(2,r),s=0));r>=8;e[n+f]=255&c,f+=g,c/=256,r-=8);for(s=s<<r|c,u+=r;u>0;e[n+f]=255&s,f+=g,s/=256,u-=8);e[n+f-g]|=128*p}},{}],6:[function(e,t,n){var i=Array.isArray,r=Object.prototype.toString;t.exports=i||function(e){return!!e&&"[object Array]"==r.call(e)}},{}],7:[function(e,t,n){(function(e){function t(e,t){for(var n=0,i=e.length-1;i>=0;i--){var r=e[i];"."===r?e.splice(i,1):".."===r?(e.splice(i,1),n++):n&&(e.splice(i,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function i(e,t){if(e.filter)return e.filter(t);for(var n=[],i=0;i<e.length;i++)t(e[i],i,e)&&n.push(e[i]);return n}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(e){return r.exec(e).slice(1)};n.resolve=function(){for(var n="",r=!1,o=arguments.length-1;o>=-1&&!r;o--){var s=o>=0?arguments[o]:e.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(n=s+"/"+n,r="/"===s.charAt(0))}return n=t(i(n.split("/"),function(e){return!!e}),!r).join("/"),(r?"/":"")+n||"."},n.normalize=function(e){var r=n.isAbsolute(e),o="/"===s(e,-1);return e=t(i(e.split("/"),function(e){return!!e}),!r).join("/"),e||r||(e="."),e&&o&&(e+="/"),(r?"/":"")+e},n.isAbsolute=function(e){return"/"===e.charAt(0)},n.join=function(){var e=Array.prototype.slice.call(arguments,0);return n.normalize(i(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},n.relative=function(e,t){function i(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=n.resolve(e).substr(1),t=n.resolve(t).substr(1);for(var r=i(e.split("/")),o=i(t.split("/")),s=Math.min(r.length,o.length),c=s,a=0;s>a;a++)if(r[a]!==o[a]){c=a;break}for(var u=[],a=c;a<r.length;a++)u.push("..");return u=u.concat(o.slice(c)),u.join("/")},n.sep="/",n.delimiter=":",n.dirname=function(e){var t=o(e),n=t[0],i=t[1];return n||i?(i&&(i=i.substr(0,i.length-1)),n+i):"."},n.basename=function(e,t){var n=o(e)[2];return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},n.extname=function(e){return o(e)[3]};var s="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return 0>t&&(t=e.length+t),e.substr(t,n)}}).call(this,e("_process"))},{_process:8}],8:[function(e,t,n){function i(){h=!1,c.length?u=c.concat(u):d=-1,u.length&&r()}function r(){if(!h){var e=setTimeout(i);h=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,h=!1,clearTimeout(e)}}function o(e,t){this.fun=e,this.array=t}function s(){}var c,a=t.exports={},u=[],h=!1,d=-1;a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new o(e,t)),1!==u.length||h||setTimeout(r,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=s,a.addListener=s,a.once=s,a.off=s,a.removeListener=s,a.removeAllListeners=s,a.emit=s,a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],9:[function(e,t,n){(function(n,i){"use strict";function r(e,t){var n=h(e,t);if(n in d){var i=d[n].calculate(e,t);if(i!==!1)return i.type=n,i}throw new TypeError("unsupported file type")}function o(e,t){c.open(e,"r",function(e,n){if(e)return t(e);var r=c.fstatSync(n).size,o=Math.min(r,f),s=new i(o);c.read(n,s,0,o,0,function(e){return e?t(e):void c.close(n,function(e){t(e,s)})})})}function s(e){var t=c.openSync(e,"r"),n=c.fstatSync(t).size,r=Math.min(n,f),o=new i(r);return c.readSync(t,o,0,r,0),c.closeSync(t),o}var c=e("fs"),a=e("path"),u=n.env.TEST_COV?"../lib-cov/":"../lib/",h=e(u+"detector"),d={},l=e(u+"types");l.forEach(function(t){d[t]=e(u+"types/"+t)});var f=131072;t.exports=function(e,t){if(e instanceof i)return r(e);if("string"!=typeof e)throw new TypeError("invalid invocation");var n=a.resolve(e);if("function"!=typeof t){var c=s(n);return r(c,n)}o(n,function(e,i){if(e)return t(e);var o;try{o=r(i,n)}catch(s){e=s}t(e,o)})}}).call(this,e("_process"),e("buffer").Buffer)},{_process:8,buffer:3,fs:2,path:7}],10:[function(e,t,n){function i(e,t){var n;return n=t?new o(e,t):new o(e)}var r=function(){return this}(),o=r.WebSocket||r.MozWebSocket,s=e("./version");t.exports={w3cwebsocket:o?i:null,version:s}},{"./version":11}],11:[function(e,t,n){t.exports=e("../package.json").version},{"../package.json":12}],12:[function(e,t,n){t.exports={name:"websocket",description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],author:{name:"Brian McKelvey",email:"brian@worlize.com",url:"https://www.worlize.com/"},contributors:[{name:"Iñaki Baz Castillo",email:"ibc@aliax.net",url:"http://dev.sipdoc.net"}],version:"1.0.22",repository:{type:"git",url:"git+https://github.com/theturtle32/WebSocket-Node.git"},homepage:"https://github.com/theturtle32/WebSocket-Node",engines:{node:">=0.8.0"},dependencies:{debug:"~2.2.0",nan:"~2.0.5","typedarray-to-buffer":"~3.0.3",yaeti:"~0.0.4"},devDependencies:{"buffer-equal":"^0.0.1",faucet:"^0.0.1",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-jshint":"^1.11.2","jshint-stylish":"^1.0.2",tape:"^4.0.1"},config:{verbose:!1},scripts:{install:"(node-gyp rebuild 2> builderror.log) || (exit 0)",test:"faucet test/unit",gulp:"gulp"},main:"index",directories:{lib:"./lib"},browser:"lib/browser.js",license:"Apache-2.0",gitHead:"19108bbfd7d94a5cd02dbff3495eafee9e901ca4",bugs:{url:"https://github.com/theturtle32/WebSocket-Node/issues"},_id:"websocket@1.0.22",_shasum:"8c33e3449f879aaf518297c9744cebf812b9e3d8",_from:"websocket@>=1.0.22 <2.0.0",_npmVersion:"2.14.3",_nodeVersion:"3.3.1",_npmUser:{name:"theturtle32",email:"brian@worlize.com"},maintainers:[{name:"theturtle32",email:"brian@worlize.com"}],dist:{shasum:"8c33e3449f879aaf518297c9744cebf812b9e3d8",tarball:"http://registry.npmjs.org/websocket/-/websocket-1.0.22.tgz"},_resolved:"https://registry.npmjs.org/websocket/-/websocket-1.0.22.tgz",readme:"ERROR: No README data found!"}},{}],13:[function(e,t,n){"use strict";var i="iphone",r="ipod",o="ipad",s=e("../environment/index"),c=s.getUserAgent().toLowerCase(),a=s.getAppName();t.exports={detectIphone:function(){return c.search(i)>-1},detectIpad:function(){return c.search(o)>-1},detectIpod:function(){return c.search(r)>-1},detectIOS:function(){return this.detectIphone()||this.detectIpod()||this.detectIpad()},detectAndroid:function(){return c.indexOf("android")>-1},detectInternetExplorerVersion:function(){var e=-1;if("Microsoft Internet Explorer"===a){var t=new RegExp(/msie ([0-9]{1,}[\.0-9]{0,})/);null!==t.exec(c)&&(e=parseFloat(RegExp.$1))}return e},onLoad:function(e){var t=Array.prototype.slice.call(arguments).slice(1),n=function(){e.apply(null,t)};s.loadComplete()?n():s.addLoadListener(n)}}},{"../environment/index":34}],14:[function(e,t,n){"use strict";var i=e("../../environment/index"),r=e("../../util/resource-util"),o=e("../../util/bind"),s=e("../../log/logger"),c=s.getLogger("Flash Util"),a=96,u=function(e,t){i.injectScript(e,t)},h=function(e){c.info("embedding..."),i.getSwfObject().embedSWF(e.url,e.id,"1","1",e.version,"",e.flashvars,e.params,e.attributes,function(t){t.success===!1?e.error("Could not properly embed Flash fallback."):t.success===!0&&e.success()})},d=function(e,t){var n={id:void 0,flashvars:void 0,url:t.options.swfUrl,version:"9.0.124",params:{quality:"high",bgcolor:"#ffffff",allowscriptaccess:"always",allowfullscreen:"true"},attributes:{id:t.flashObjID,name:"Red5 Pro Second Screen Host",align:"middle",style:"float:left;z-index:-1;position:absolute;margin-top:-1px;"},error:o(t.options._error,t.options),success:o(t.options._success,t.options)},s=t.options.controlsUrl,d=i.createElement("div");d.id="red5pro-secondscreen-host-wrapper"+Math.floor(16777215*Math.random()*16777215).toString(16),i.appendElementToBody(d),d.style.zIndex=1e4,d.style.position="fixed",d.style.width="8px",d.style.height="8px",d.style.left="0px",d.style.bottom="0px",d.style.overflowX="hidden",d.style.overflowY="hidden";var l=i.createElement("div");l.id="red5pro-secondscreen-host-wrapper"+Math.floor(16777215*Math.random()*16777215).toString(16),i.appendElementToContainer(l,d);var f={globalName:i.globalName,bmDeviceName:encodeURIComponent(t.options.name),bmControllerXML:void 0,
bmControllerUrl:void 0!==s?i.getAbsoluteUrl(s):void 0,wmode:"window",debug:"true"};c.info("Flash Object global name: "+f.globalName+"."),t&&t.options&&void 0!==t.options.appId&&void 0!==t.options.portalId?(f.bmDeviceId=t.options.appId,f.bmPortalId=t.options.portalId):f.bmDeviceId=Math.floor(16777215*Math.random()*16777215).toString(16),f.bmMaxPlayers=void 0!==t.options.maxPlayers?t.options.maxPlayers:a,t.deviceId=t.options.deviceId=f.bmDeviceId,r.generateControllerXML(t.options.design,function(e){f.bmControllerXML=encodeURIComponent(e),n.id=l.id,n.flashvars=f,"undefined"==typeof i.getSwfObject()?(c.info("Inject swfobject..."),u(t.options.swfobjectUrl,function(){h(n)})):(c.info("Embed SWF with swfobject."),h(n))})};t.exports={initializeFlashObject:d,getFlashObjectById:function(e){return i.getElement(e)}}},{"../../environment/index":34,"../../log/logger":37,"../../util/bind":43,"../../util/resource-util":48}],15:[function(e,t,n){"use strict";var i=e("../struct/base-classes"),r=e("../event/bridge"),o=e("../enum/encoding-type"),s=e("../util/debounce"),c=e("../util/bind"),a=e("../environment/index"),u=e("../log/logger"),h=e("../enum/error-type"),d=r.EventTypes,l=function(e,t){this.host=e,this.reliablePort=t,this.unreliablePort=t},f=function(e,t,n){this.methodName=e,this.returnMethod=t,this.data=n,this.ws=32},g=function(e,t){this.deviceId=e,this.deviceName=t,this.deviceType="WEBSOCKET",this.encodeType=o.FLASH},p=function(e){return"ws://"+e+":6262/secondscreen"},v="10.0.0.1",E={REGISTER:{method:"registry.register",handler:"onRegister"},UNREGISTER:{method:"registry.remove",handler:"onUnregister"},UPDATE:{method:"registry.update",handler:""},VISIBILITY:{method:"registry.setVisible",handler:""}},m=function(e,t){return new f(e.method,e.handler,t)},y=function(e){var t,n=e.length,i=[];for(t=0;n>t;t++)i[t]=e[t].value;return i},I=function(e,t){e._error.apply(e,[h.REGISTER_FAILURE,t])},b=i.EventEmitter.extend({init:function(e){this.domain={value:"secondscreen"},this.clientInfo={appId:e.options.appId,device:new g(e.options.deviceId,e.options.name),address:new l("192.168.2.1",6666),slotId:1,currentPlayers:0,maxPlayers:e.options.maxPlayers},this.hostConfig=e,this.websocket=null,this.registryUrl=p(e.options.registryAddress||v),this.update=s(this.update,500,this),this.logger=u.getLogger("WebSocket Registry"),this.logger.info("New Registry created for url "+this.registryUrl+"."),this.logger.info("Application id "+this.clientInfo.appId)},start:function(){try{this.logger.info("Request to start registry."),this.websocket=a.createWebSocket(this.registryUrl),this.websocket.onopen=c(this.onOpen,this),this.websocket.onmessage=c(this.onMessage,this),this.websocket.onerror=c(this.onError,this),this.websocket.onclose=c(this.onClose,this)}catch(e){throw new Error({type:h.REGISTER_FAILURE,message:e.message})}},stop:function(){var e=this.websocket;e.onopen=e.onclose=e.onmessage=e.onerror=null;try{var t=m(E.UNREGISTER,[this.clientInfo]);e.send(JSON.stringify(t)),e.close()}catch(n){}this.logger.info("Stopping registry.")},update:function(){var e=m(E.UPDATE,[this.clientInfo]);this.websocket.send(JSON.stringify(e))},setVisibility:function(e){var t=m(E.VISIBILITY,[{value:e},{value:!0}]);this.websocket.send(JSON.stringify(t))},setPlayerCount:function(e){this.logger.info("Setting current player count to "+e),this.clientInfo.currentPlayers=e,this.update()},onOpen:function(){this.logger.info("Registry socket opened.");var e=m(E.REGISTER,[this.clientInfo]);this.websocket.send(JSON.stringify(e))},onClose:function(){this.logger.info("Registry socket closed."),r.triggerWithType(d.REGISTRY_DISCONNECT,{})},onError:function(e){this.logger.error("Registry socket error: "+e.error),I(this.hostConfig.options,e.error),r.triggerWithType(d.REGISTRY_DISCONNECT,{error:e.error})},onRegister:function(e){e?this.logger.info("Registration accepted."):(this.logger.warn("Registration rejected. Url "+this.registryUrl+", appid: "+this.clientInfo.appId),I(this.hostConfig.options,"[WebSocketRegistryConnection]:: Failed to register"))},onUnregister:function(e){e?this.logger.info("Unregistration of host accepted."):(this.logger.warn("Unregistration rejected. Url "+this.registryUrl+", appid: "+this.clientInfo.appId),I(this.hostConfig.options,"[WebSocketRegistryConnection]:: Failed to unregister host."))},onMessage:function(e){var t=JSON.parse(e.data);switch(t.ws){case 32:var n=y(t.data),i=this[t.methodName];"function"==typeof i?(this.logger.info("Method invocation on Registry: "+t.methodName+"."),i.apply(this,n)):this.logger.warn("RegistryConnection function "+t.methodName+" not found: "+t.methodName+".");break;case 35:}},onHostConnected:function(e){e.device.deviceId===this.clientInfo.device.deviceId&&(this.clientInfo=e,r.triggerWithType(d.SHOW_SLOT_COLOR,{data:{slot:e.slotId}}))},onHostUpdate:function(e){e.device.deviceId===this.clientInfo.device.deviceId&&(this.clientInfo=e)},deviceConnectRequested:function(e){r.trigger(d.DEVICE_CONN_REQUEST,e)}});t.exports={WebSocketRegistry:b,createWebSocketRegistry:function(e,t){return new b(e,t)}}},{"../enum/encoding-type":30,"../enum/error-type":31,"../environment/index":34,"../event/bridge":36,"../log/logger":37,"../struct/base-classes":42,"../util/bind":43,"../util/debounce":44}],16:[function(e,t,n){"use strict";var i=e("../enum/encoding-type"),r=[],o=function(e){return{major:e>>24&255,minor:e>>16&255}},s=function(e){return{encodeType:e[0],type:e[1],id:e[2],name:e[3]}},c=function(e){return{device:s(e[1]),address:g(e[2])}},a=function(e){return{uid:e[1],address:g(e[2])}},u=function(){return{}},h=function(e){return{setId:e[1],startByte:e[2],chunkSize:e[3],totalSize:e[4],data:e[5]}},d=function(e){var t=0,n={};return n.device=s(e[++t]),n.address=g(e[++t]),n.appId=e[++t],n.slotId=e[++t],n.slotId>0&&(n.currentPlayers=e[++t],n.maxPlayers=e[++t]),n},l=function(e){var t=r[e[0]];if(t)return t(e);throw new Error("[websocket-serializer]:: No decoder for "+e)},f=function(e){var t={},n=0;return t.channel=e[++n],t.sequence=e[++n],t.timestamp=e[++n],t.rtt=e[++n],t.type=e[++n],t.deviceType=e[++n],t.deviceId=e[++n],t.deviceName=e[++n],e[++n]&&(t.message=l(e[++n])),t},g=function(e){return{hostname:e[1],udpPort:e[2],tcpPort:e[3]}},p=function(e){var t=e[1],n=e[2];return"@"===t&&(n=l(n)),[t,n]},v=function(e){var t,n,i=0,r=[],o={};for(++i,o.method=e[++i],o.returnMethod=e[++i],o.params=r,t=e[++i],n=i+t;n>i;)r.push(p(e[++i]));return o},E=function(e){return{x:e[1],y:e[2],z:e[3]}},m=function(e){var t,n=0,i=e[++n],r=[];for(t=0;i>t;++t){var o={};o.x=e[++n],o.y=e[++n],o.viewWidth=e[++n],o.viewHeight=e[++n],o.phase=e[++n],o.id=e[++n],r.push(o)}return{touches:r}},y=function(e){return{x:e[1],y:e[2],z:e[3]}},I=function(e){return{x:e[1],y:e[2],z:e[3],w:e[4]}},b=function(e){return{horizontal:e[1],vertical:e[2]}},C=function(e){return{id:e[2],value:e[1],isDown:e[3]}};!function(){r[i.PACKET]=f,r[i.ADDRESS]=g,r[i.PARAMETER]=p,r[i.INVOKE]=v,r[i.ACCELERATION]=E,r[i.TOUCH_SET]=m,r[i.ACK]=c,r[i.PING]=a,r[i.SHAKE]=u,r[i.BYTE_CHUNK]=h,r[i.REGISTRY_INFO]=d,r[i.GYRO]=y,r[i.ORIENTATION]=I,r[i.DPAD]=b,r[i.SLIDER]=C,r[i.DEVICE_IPHONE]=s,r[i.DEVICE_UNITY]=s,r[i.DEVICE_ANDROID]=s,r[i.DEVICE_NATIVE]=s,r[i.DEVICE_PALM]=s,r[i.DEVICE_FLASH]=s}(),t.exports={verifyHandshake:function(e,t,n){return o(e[0])===t&&o(e[1])===n},decodeObject:l,decodePacket:f}},{"../enum/encoding-type":30}],17:[function(e,t,n){"use strict";var i,r=e("../struct/base-classes"),o=e("../event/bridge"),s=e("../util/bind"),c=e("../util/resource-util"),a=e("../log/logger"),u=e("../enum/control-mode-type"),h=o.EventTypes,d={gyroscope:1,orientation:2},l=function(e,t,n){var i=c.cloneDesign(e);return i.commit=t,i.get=n,i},f=r.EventEmitter.extend({init:function(e,t,n){this._super(),this.id=t||(new Date).getTime().toString(),this.name=e||"Device-"+this.id,this.touchEnabled=!1,this.touchInterval=.1,this.accelerometerEnabled=!1,this.accelerometerInterval=.1,this.gyroEnabled=!1,this.gyroInterval=.1,this.orientationEnabled=!1,this.orientationInterval=.1,this.capabilities=0,this.mode=u.isValid(n)?n:u.GAMEPAD},setMode:function(e){e&&u.isValid(e)&&(this.mode=e)},getMode:function(){return this.mode},hasCapability:function(e){if(!(e in d))throw new Error("unknown capability: "+e);return 0!==(this.capabilities&d[e])}}),g=f.extend({init:function(e,t,n){this._super(e,t,n.options.controlMode),this.config=n,this.touchEnabled=n.options.design.touchEnabled,this.accelerometerEnabled=n.options.design.accelerometerEnabled,this.onConnectionMessage=s(this.onConnectionMessage,this),this.updateControlScheme=s(this.updateControlScheme,this),this.getControlSchemeElement=s(this.getControlSchemeElement,this),this.design=l(this.config.options.design,this.updateControlScheme,this.getControlSchemeElement),this.messageBuilder=void 0,o.on(h.CONNECTION_MESSAGE,this.onConnectionMessage),this.logger=a.getLogger("Generic Device Connection")},close:function(){o.off(h.CONNECTION_MESSAGE,this.onConnectionMessage)},sendInvoke:function(e){throw new Error("Requires override for message: "+e+".")},send:function(){throw new Error("Requires override.")},updateControlScheme:function(){throw new Error("Requires override.")},getControlSchemeElement:function(e){throw new Error("Requires override for id: "+e+".")},onConnectionMessage:function(e){return e.data.device===this},waitForNewHost:function(e){this.sendInvoke(this.messageBuilder.createWaitForMessage(e)),this.mode=u.WAIT},vibrate:function(){this.sendInvoke(this.messageBuilder.createVibrateMessage())},editDesign:function(){return this.design},setMode:function(e,t){var n;this.mode!==e&&(n=u.index(e),u.isValid(e)?(this.logger&&this.logger.info("Setting new mode "+e+" on Device Connection "+this.id),this.sendInvoke(this.messageBuilder.createSetControlModeMessage(n,t)),this.mode=e):this.logger&&this.logger.error("Unknown control mode "+e))}});!function(e){var t,n=["gyro","touch","accelerometer","orientation"],r=n.length,o=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},s=function(e){var t=o(e);return{enabledField:e+"Enabled",enableMethod:"set"+t+"Enabled",intervalField:e+"Interval",intervalMethod:"set"+t+"Interval",accessEnabledMethod:"get"+t+"Enabled",accessIntervalMethod:"get"+t+"Interval"}},c=function(t){var n=s(t);e[n.enableMethod]=function(e){e!==this[n.enabledField]&&(this.sendInvoke(this.messageBuilder.createSensorEnableMessage(t,e,this[n.intervalField])),this[n.enabledField]=e)},e[n.intervalMethod]=function(e){e!==this[n.intervalField]&&(this.sendInvoke(this.messageBuilder.createSensorIntervalMessage(t,this[n.enabledField],e)),this[n.intervalField]=e)},e[n.accessEnabledMethod]=function(){return this[n.enabledField]},e[n.accessIntervalMethod]=function(){return this[n.intervalField]}},a=function(){for(var e,t=r,i=[];--t>-1;)e=o(n[t]),i.push("set"+e+"Enabled","get"+e+"Enabled","set"+e+"Interval","get"+e+"Interval");return i};for(t=r;--t>-1;)c(n[t]);i=a().concat(["close","setMode","send"])}(g.prototype),t.exports={Device:f,DeviceConnection:g,DeviceConnectionProxyMethods:i}},{"../enum/control-mode-type":27,"../event/bridge":36,"../log/logger":37,"../struct/base-classes":42,"../util/bind":43,"../util/resource-util":48}],18:[function(e,t,n){"use strict";var i=e("./device-base"),r=e("./websocket-device"),o=e("./flash-bridge-device");t.exports={getProxyMethods:function(){return i.DeviceConnectionProxyMethods},createDeviceConnection:function(e,t,n){return r.createConnection(e,t,n)},createBridgeConnection:function(e,t,n,i,r){var s=o.createConnection(e,t,i,r);return s.setMode(n),s}}},{"./device-base":17,"./flash-bridge-device":19,"./websocket-device":23}],19:[function(e,t,n){"use strict";var i=e("./device-base").DeviceConnection,r=e("../event/bridge"),o=e("../util/resource-util"),s=e("./flash-message-builder"),c=e("../log/logger"),a=r.ConnectionEventTypes,u=i.extend({init:function(e,t,n,i){this._super(e,t,n),this.messageBuilder=s,this.invokeChannel=i,this.logger=c.getLogger("Fl Bridge Connection"),this.logger.info("New Bridge Connection created. Name: "+e+", DeviceId: "+t)},updateControlScheme:function(){var e=o.generateUpdateXML(this.design);this.sendInvoke(this.messageBuilder.createControlDesignUpdateMessage(e))},getControlSchemeElement:function(e){for(var t,n=this.design.layout,i=n?n.length:0;--i>-1;)if(t=n[i],t.id===e)return t;return void this.logger.warn("Could not find control scheme element with id "+e+".")},send:function(e){var t=Array.prototype.splice.call(arguments,1);this.sendInvoke(this.messageBuilder.createMessageToJs(e,t))},sendInvoke:function(e){e.call(this,this.invokeChannel,this.id)},onConnectionMessage:function(e){var t=e.type,n=e.data;this._super(e)&&(this.logger.info("Device Message received: "+t+"."),n.device.id===this.id&&(t===a.CONTROL_SCHEME||t===a.SEND_PORTAL_ID||t===a.SET_CAPABILITIES&&(this.capabilities=n.capabilities?n.capabilities:0),this.trigger(t,e.data)))}});t.exports={createConnection:function(e,t,n,i){return new u(e,t,n,i)}}},{"../event/bridge":36,"../log/logger":37,"../util/resource-util":48,"./device-base":17,"./flash-message-builder":21}],20:[function(e,t,n){"use strict";var i=e("../struct/base-classes"),r=e("../environment/index"),o=e("../event/bridge"),s=e("../util/json-util"),c=e("../log/logger"),a=o.EventTypes,u=o.DeviceEventTypes,h=o.ConnectionEventTypes,d=["FlashLoaded","DeviceAvailable","DeviceConnected","DeviceDisconnected","DeviceEcho","NavigationString","TouchesReceived","KeyString","Invocation","ShakeReceived","AccelReceived","DPadReceived","SliderChange","Log","ShowSlot"],l=c.getLogger("Flash Responder"),f={setCapabilities:function(e,t){var n=t[0].Value,i=this.getDeviceById(e.id);l.info("Set capabilities ["+n+"] for device: "+i.id+"."),o.triggerConnectionMessage(h.SET_CAPABILITIES,{device:i,capabilities:n})},bmPause:function(e){l.info("Pause request for device: "+e.id+"."),o.triggerDeviceMessage(u.PAUSE,{device:e})},handleButtonAction:function(e,t,n){var i,r;return"undefined"==typeof n||1!==n.length?!1:(i=n[0].Value,"up"===i||"down"===i?(r="up"===i?u.BUTTON_UP:u.BUTTON_DOWN,o.triggerDeviceMessage(r,{device:e,id:t}),!0):!1)},onControlsUrlChange:function(e,t){o.triggerDeviceMessage(u.CONTROLS_URL_CHANGE,{device:e,url:t[0].Value})},messageFromJs:function(e,t){for(var n,i,r=t[0].Value,c=r.methodName,a=r.parameters,h=[],d=0;d<a.length;++d)n=a[d].Value,i=s.toJSON(n),h[d]="string"==typeof n&&i?i:n;o.triggerDeviceMessage(u.MESSAGE,{device:e,message:c,state:1===h.length?h[0]:h})}},g=i.Class.extend({init:function(e){this.target=e,this.devices={}},getDeviceById:function(e){return this.devices.hasOwnProperty(e)?this.devices[e]:void 0},FlashLoaded:function(){o.triggerConnectionMessage(h.FLASH_RUNTIME_LOADED,{})},ShowSlot:function(e){l.info("Show slot color. id: "+e+"."),o.triggerWithType(a.SHOW_SLOT_COLOR,{data:{slot:e}})},Invocation:function(e,t){var n=this.getDeviceById(t),i=e.parameters,r=e.methodName;l.info("Device Invocation. id: "+t+", invocation: "+JSON.stringify(e,null,2)),f.hasOwnProperty(r)?f[r].call(this,n,i):f.handleButtonAction(n,r,i)||l.warn("Could not handle method invocation. methodName: "+r+".")},DeviceAvailable:function(e){l.info("Device Available. device: "+JSON.stringify(e,null,2)),o.trigger(a.DEVICE_CONN_REQUEST,e)},DeviceConnected:function(e){var t=e.deviceId,n=e.deviceName,i=this.getDeviceById(t);l.info("Device Connected. id: "+t+", name: "+n+"."),i&&(o.triggerConnectionMessage(h.ADD_DEVICE,{device:i}),o.triggerDeviceMessage(u.MESSAGE,{device:i,message:"ready"}))},DeviceDisconnected:function(e){var t=e.deviceId,n=e.deviceName;l.info("Device Disonnected. id: "+t+", name: "+n+"."),o.triggerConnectionMessage(h.REMOVE_DEVICE,{device:this.getDeviceById(t)})},DeviceEcho:function(e,t){l.info("Echo: "+e+".\nDevice:\n"+JSON.stringify(t,null,2))},NavigationString:function(e,t){l.info("Navigation Event. "+t+"."),o.triggerDeviceMessage(u.NAVIGATION,{device:this.getDeviceById(e),string:t})},KeyString:function(e,t){l.info("KeyString Event."+t+"."),o.triggerDeviceMessage(u.KEYBOARD,{device:this.getDeviceById(e),text:t})},TouchesReceived:function(e){var t,n,i,r=e.deviceId,s=e.touches,c=s.length;for(t=0;c>t;t++){switch(n=s[t],n.phase.value){case 1:i=u.TOUCH_START;break;case 2:i=u.TOUCH_MOVE;break;case 4:i=u.TOUCH_END;break;default:l.warn("Could not handle touch type of phase: "+n.phase+".\n"+JSON.stringify(e,null,2))}o.triggerDeviceMessage(i,{device:this.getDeviceById(r),x:n.x,y:n.y,id:r+n.id})}},AccelReceived:function(e){var t=e.deviceId,n=e.acceleration;o.triggerDeviceMessage(u.ACCELERATION,{device:this.getDeviceById(t),acceleration:n})},ShakeReceived:function(e){var t=e.deviceId;o.triggerDeviceMessage(u.SHAKE,{device:this.getDeviceById(t)})},SliderChange:function(e){var t=e.deviceId;o.triggerDeviceMessage(u.SLIDER,{device:this.getDeviceById(t),id:e.sliderId,value:e.value})},DPadReceived:function(e){var t=e.deviceId;o.triggerDeviceMessage(u.DPAD,{device:this.getDeviceById(t),horizontal:e.horizontal,vertical:e.vertical})}}),p=g.extend({init:function(e){this._super(e),r.defineGlobalTarget(this)},register:function(e){l.info("Register connection to bridge responder: "+e.id),this.devices[e.id]=e},unregister:function(e){l.info("Unregister connection to bridge responder: "+e.id),this.devices.hasOwnProperty(e.id)&&delete this.devices[e.id]},unregisterAll:function(){var e;for(e in this.devices)delete this.devices[e]},connectionSuccess:function(e){var t;this.devices.hasOwnProperty(e)?(t=this.devices[e],o.triggerConnectionMessage(h.ADD_DEVICE,{device:t})):l.info("Could not find device registered with id: "+e+".")},boomBa:function(e){l.info("Flash fallback embedded successfully. "+e+".")},log:function(e){l.info("Flash action taken: "+e+".")},helper:{logger:function(){return c.getLogger("Flash Resp.Helper")}(),helperTick:function(){},__noSuchMethod__:function(e,t){this.logger.warn("No such method: "+e+", "+JSON.stringify(t,null,2))}}});!function(e){for(var t,n=d.length,i=function(e){return["on",e,"Internal"].join("")};--n>-1;)t=d[n],e[i(t)]=e[t];e.showSlotInternal=e.ShowSlot,e.__noSuchMethod__=function(e,t){l.warn("No Such Method: "+e+", "+JSON.stringify(t,null,2))}}(p.prototype),t.exports={create:function(e){return new p(e)}}},{"../environment/index":34,"../event/bridge":36,"../log/logger":37,"../struct/base-classes":42,"../util/json-util":46}],21:[function(e,t,n){"use strict";var i=e("../log/logger"),r=e("../enum/control-mode-type"),o=i.getLogger("Flash Message Builder"),s=function(e){var t=r.value(e),n="SetGamepadMode";switch(t){case r.NAVIGATION:n="SetNavMode";break;case r.KEYBOARD:n="SetKeyboardMode";break;case r.WAIT:n="SetWaitMode"}return o.info("Request Control Mode: "+t+"."),n};t.exports={createSetControlModeMessage:function(e,t){var n=s(e);return function(e,i){return"string"==typeof t?e[n](i,t):e[n](i)}},createWaitForMessage:function(){return function(e,t){return e.SetWaitForNewHost(t)}},createSensorEnableMessage:function(e,t,n){return e=e.charAt(0).toUpperCase()+e.slice(1),function(i,r){return o.info("Enable sensor: "+e+", enabled: "+t+", interval: "+n),i["Enable"+e](r,t,n)}},createSensorIntervalMessage:function(e,t,n){return this.createSensorEnableMessage(e,t,n)},createControlDesignUpdateMessage:function(e,t){return function(n,i){return n.updateControlPad(i,e,t||function(){})}},createVibrateMessage:function(){return function(e,t){return e.VibrateDevice(t)}},createMessageToJs:function(e,t){return function(n,i){return n.MessageToJs(i,e,t)}}}},{"../enum/control-mode-type":27,"../log/logger":37}],22:[function(e,t,n){"use strict";var i=e("../struct/base-classes"),r=e("../event/bridge"),o=e("../util/json-util"),s=e("../log/logger"),c=e("../enum/channel-type"),a=r.DeviceEventTypes,u=r.ConnectionEventTypes,h=s.getLogger("WebSocket Channel Responder"),d={RequestXML:function(e){r.triggerConnectionMessage(u.CONTROL_SCHEME,{device:e})},GetPortalId:function(e,t){r.triggerConnectionMessage(u.SEND_PORTAL_ID,{device:e,returnMethod:t.returnMethod})},setCapabilities:function(e,t){r.triggerConnectionMessage(u.SET_CAPABILITIES,{device:e,capabilities:t.params[0][1]}),r.triggerConnectionMessage(u.ADD_DEVICE,{device:e})},onControlSchemeParsed:function(e){r.triggerDeviceMessage(a.MESSAGE,{device:e,message:"ready"})},WaitCancelled:function(e){r.triggerDeviceMessage(a.WAIT_CANCELLED,{device:e})},bmPause:function(e){r.triggerDeviceMessage(a.PAUSE,{device:e})},onKeyString:function(e,t){r.triggerDeviceMessage(a.KEYBOARD,{device:e,text:t.params[0][1]})},onNavigationString:function(e,t){r.triggerDeviceMessage(a.NAVIGATION,{device:e,string:t.params[0][1]})},onControlsUrlChange:function(e,t){r.triggerDeviceMessage(a.CONTROLS_URL_CHANGE,{device:e,url:t.params[0][1]})},messageFromJs:function(e,t){for(var n,i,s,c=t.params[0][1],u=c.method,h=c.params,d=0;d<h.length;++d)i=h[d][0],s=h[d][1],n=o.toJSON(s),h[d]="*"===i&&n?n:s;r.triggerDeviceMessage(a.MESSAGE,{device:e,message:u,state:1===h.length?h[0]:h})}},l=function(e,t){var n,i;1===t.params.length&&(n=t.params[0][1],("up"===n||"down"===n)&&(i="up"===n?a.BUTTON_UP:a.BUTTON_DOWN,r.triggerDeviceMessage(i,{device:e,id:t.method})))},f=i.Class.extend({init:function(e){this.target=e},handlePacket:function(e){var t=e.channel,n=e.deviceName,i=e.message,o=i?i.method:void 0;if(void 0!==o&&t===c.MESSAGE)this.target.name=n,h.info("Message received: "+o+"."),d.hasOwnProperty(o)?d[o].call(null,this.target,i):l(this.target,i);else if(c.SHAKE===t)r.triggerDeviceMessage(a.SHAKE,{device:this.target});else if(c.ACCELERATION===t)r.triggerDeviceMessage(a.ACCELERATION,{device:this.target,acceleration:i});else if(c.TOUCH===t){var s,u,f=i.touches,g=f.length;for(s=0;g>s;s++){switch(f[s].phase){case 1:u=a.TOUCH_START;break;case 2:u=a.TOUCH_MOVE;break;case 4:u=a.TOUCH_END}r.triggerDeviceMessage(u,{device:this.target,x:f[s].x,y:f[s].y,id:this.target.id+f[s].id})}}else c.GYRO===t?r.triggerDeviceMessage(a.GYROSCOPE,{device:this.target,gyroscope:i}):c.ORIENTATION===t?r.triggerDeviceMessage(a.ORIENTATION,{device:this.target,orientation:i}):c.DPAD===t?r.triggerDeviceMessage(a.DPAD,{device:this.target,horizontal:i.horizontal,vertical:i.vertical}):c.SLIDER===t&&r.triggerDeviceMessage(a.SLIDER,{device:this.target,id:i.id,value:i.value})}});t.exports={create:function(e){return new f(e)}}},{"../enum/channel-type":26,"../event/bridge":36,"../log/logger":37,"../struct/base-classes":42,"../util/json-util":46}],23:[function(e,t,n){"use strict";var i=e("./device-base").DeviceConnection,r=e("../event/bridge"),o=e("../encoding/websocket-serializer"),s=e("../decoding/websocket-deserializer"),c=e("./websocket-channel-responder"),a=e("./websocket-message-builder"),u=e("../util/bind"),h=e("../util/resource-util"),d=e("../log/logger"),l=e("../enum/control-mode-type"),f=e("../enum/encoding-type"),g=e("../enum/packet-type"),p=e("../enum/channel-type"),v=r.EventTypes,E=r.ConnectionEventTypes,m=e("../environment/index"),y={major:1,minor:4},I={channel:p.BYTE,message:void 0},b=function(e,t){return t&&(e.major<t.major||e.major===t.major&&e.minor<t.minor)?t:e},C=function(e){return I.message=e,I},w=function(e){return"undefined"!=typeof e},S=i.extend({init:function(e,t,n){this._super(e,t,n),this.sequence=0,this.controlsSent=!1,this.version=y,this.minimumVersion=b(this.version,n.options.minimumVersion),this.messageBuilder=a,this.channelResponder=c.create(this),this.hostDevice=void 0,this.hostAddress=void 0,this.controlScemeChunks=void 0,this.logger=d.getLogger("Connection"),this.logger.info("New Device Connection created. Name: "+e+", DeviceId: "+t)},connect:function(e,t,n){this.url=e,this.hostDevice=t,this.hostAddress=n,this.logger.info("Request to connect on "+e+"."),this.logger.info("HostDevice for Connection "+this.id+": "+this.hostDevice.id),this.socket=m.createWebSocket(this.url),this.socket.onopen=u(this.onOpen,this),this.socket.onmessage=u(this.onInitialMessage,this),this.socket.onerror=u(this.onError,this),this.socket.onclose=u(this.onClose,this)},close:function(){var e=this.socket;"undefined"!=typeof e&&e.close(),this.logger.info("Closing Device Connection "+this.id),r.off(v.CONNECTION_MESSAGE,this.onConnectionMessage)},generatePacket:function(e){return e.sequence=++this.sequence,e.deviceId=this.hostDevice.id,e.deviceType=this.hostDevice.type,e.channel=e.channel||p.BROADCAST,e.type=e.type||g.DATA,e.rtt=0,e.timestamp=0,o.encodePacket(e)},sendInvoke:function(e){var t=this.generatePacket(e);this.logger.info("sendInvoke: "+JSON.stringify(t)),this.socket.send(JSON.stringify(t))},sendChunks:function(e){var t,n=e.length;for(t=0;n>t;++t)this.socket.send(JSON.stringify(this.generatePacket(C(e[t]))))},send:function(e){var t=Array.prototype.splice.call(arguments,1);this.sendInvoke(this.messageBuilder.createMessageToJs(e,t))},sendControlScheme:function(){var e=this.config.options.controlsUrl;this.mode===l.HTML&&void 0!==e?this.sendInvoke(this.messageBuilder.createControlsUrlMessage(m.getAbsoluteUrl(e))):void 0!==this.controlSchemeChunks?this.sendChunks(this.controlSchemeChunks):!function(e,t){var n;h.generateControllerXML(t,function(t){n=o.generateControlChunks(t),e.controlSchemeChunks=n,e.sendChunks(n)})}(this,this.design)},updateControlScheme:function(){var e=h.generateUpdateXML(this.design);this.sendChunks(o.generateUpdateChunks(e))},getControlSchemeElement:function(e){for(var t,n=this.design.layout,i=n?n.length:0;--i>-1;)if(t=n[i],t.id===e)return t;return void this.logger.warn("Could not find control scheme element with id "+e+".")},onOpen:function(){var e=o.createHandshake(this.version,this.minimumVersion);this.logger.info("Socket Opened. "+this.id),this.socket.send(JSON.stringify(e))},onClose:function(){this.logger.info("Socket Closed. "+this.id),r.trigger(v.CONNECTION_MESSAGE,{type:E.REMOVE_DEVICE,data:{device:this}})},onError:function(e){var t="Could not connect to device websocket layer. Error: "+e.error+", Info: ["+this.id+", "+this.name+"]";this.logger.error("Socket Error. "+t),this.onClose(),r.trigger(v.CONNECTION_MESSAGE,{type:E.DEVICE_ERROR,data:{device:this,error:t}})},onInitialMessage:function(){var e;this.logger.info("Initial handshake received for Device Connection "+this.id),this.socket.onmessage=u(this.onMessage,this),e=this.generatePacket({type:g.ACK,message:{encodeType:f.ACK,device:this.hostDevice,address:this.hostAddress}}),this.socket.send(JSON.stringify(e)),this.sendInvoke(this.messageBuilder.createTouchReliabilityMessage())},onMessage:function(e){var t=JSON.parse(e.data),n=s.decodePacket(t);this.channelResponder.handlePacket(n)},onConnectionMessage:function(e){var t=e.type,n=e.data;if(this._super(e)){if(this.logger.info("Device Message received: "+t),t===E.CONTROL_SCHEME)this.sendControlScheme();else if(t===E.SEND_PORTAL_ID){var i=this.config.options.portalId,r=w(i);this.logger.warn("Is portal id "+i+" valid? "+w(i)),r&&this.sendInvoke(this.messageBuilder.createSendPortalIdMessage(n.returnMethod,i))}else t===E.SET_CAPABILITIES&&(this.capabilities=n.capabilities?n.capabilities:0);this.trigger(t,e.data)}}});t.exports={createConnection:function(e,t,n){return new S(e,t,n)}}},{"../decoding/websocket-deserializer":16,"../encoding/websocket-serializer":25,"../enum/channel-type":26,"../enum/control-mode-type":27,"../enum/encoding-type":30,"../enum/packet-type":32,"../environment/index":34,"../event/bridge":36,"../log/logger":37,"../util/bind":43,"../util/resource-util":48,"./device-base":17,"./websocket-channel-responder":22,"./websocket-message-builder":24}],24:[function(e,t,n){"use strict";var i=e("../enum/channel-type"),r=e("../enum/encoding-type"),o=function(e,t,n){return{channel:i.MESSAGE,message:{method:e,returnMethod:t,params:n,encodeType:r.INVOKE}}},s=function(e){if("number"==typeof e)return e===(0|e)?["i",e]:["f",e];if("string"==typeof e||e instanceof String)return["*",e];if("object"==typeof e)return["*",JSON.stringify(e)];if(null===e)return["*",""];throw new Error("Unable to encode value: "+e)},c=function(e){for(var t=[],n=0;n<e.length;++n)t[n]=s(e[n]);return{array:t,encodeType:r.TAGGED_ARRAY}};t.exports={createInvokeMessage:o,createSendPortalIdMessage:function(e,t){return o(e,"",[["*",t]])},createTouchReliabilityMessage:function(){return o("setReliabilityForTouch","",[["i",2],["i",2]])},createSetControlModeMessage:function(e,t){var n="SetControlMode",i="";return void 0!==t?o(n,i,[["i",e],["*",t]]):o(n,i,[["i",e]])},createWaitForMessage:function(e){return o("WaitForNewHost",[["*",e]])},createSensorEnableMessage:function(e,t){return e=e.charAt(0).toUpperCase()+e.slice(1),o("enable"+e,"",[["B",t]])},createSensorIntervalMessage:function(e,t,n){return e=e.charAt(0).toUpperCase()+e.slice(1),o("set"+e+"Interval","",[["f",n]])},createVibrateMessage:function(){return o("vibrate","",[])},createControlsUrlMessage:function(e){return o("loadControlsUrl","",[["*",e]])},createMessageToJs:function(e,t){return o("messageToJs","",[["*",e],["@",c(t)]])}}},{"../enum/channel-type":26,"../enum/encoding-type":30}],25:[function(e,t,n){"use strict";var i=e("../enum/encoding-type"),r=e("../environment/index"),o=[],s=function(e){return r.base64Encode(e)},c=function(e){return(255&e.major)<<24|(255&e.minor)<<16},a=function(e,t){var n,r,o,c,a=32768,u=[],h=e.length,d=0,l=0;for(d=0;h>d;d+=a)n=s(e.substr(d,a)),r=n[0],o=n[1],u.push({encodeType:i.BYTE_CHUNK,setId:t,startByte:l,chunkSize:r,data:o}),l+=r;for(c=u.length;--c>-1;)u[c].totalSize=l;return u},u=function(e){return[e.encodeType,e.type,e.id,e.name]},h=function(e){return[i.ACK,u(e.device),m(e.address)]},d=function(e){return[i.PING,e.uid,m(e.address)]},l=function(){return[i.SHAKE,0]},f=function(e){return[i.BYTE_CHUNK,e.setId,e.startByte,e.chunkSize,e.totalSize,e.data]},g=function(e){var t,n,r=e.array,o=[i.TAGGED_ARRAY,r.length],s=r.length;for(t=0;s>t;++t)n=r[t],o.push(n[0]),o.push("@"===n[0]?v(n[1]):n[1]);return o},p=function(e){var t=[i.REGISTRY_INFO,u(e.device),m(e.address),e.appId,e.slotId];return e.slotId>0&&(t.push(e.currentPlayers),t.push(e.maxPlayers)),t},v=function(e){var t=o[e.encodeType];if(t)return t(e);throw new Error("[websocket-serializer]:: No encoder for "+JSON.stringify(e,null,3))},E=function(e){return[i.PACKET,e.channel,e.sequence,0,0,e.type,e.deviceType,e.deviceId,e.deviceName,!0,v(e.message)]},m=function(e){return[i.ADDRESS,e.hostname,e.udpPort,e.tcpPort]},y=function(e){return[i.PARAMETER,e[0],"@"===e[0]?v(e[1]):e[1]]},I=function(e){var t,n=e.params,r=[i.INVOKE,0,e.method,e.returnMethod,n.length],o=n.length;for(t=0;o>t;++t)r.push(y(n[t]));return r},b=function(e){return[i.ACCELERATION,e.x,e.y,e.z]},C=function(e){var t,n,r=e.touches,o=[i.TOUCH_SET,r.length],s=r.length;for(t=0;s>t;++t)n=r[t],o.push(n.x,n.y,n.viewWidth,n.viewHeight,n.phase,n.id);return o},w=function(e){return[i.GYRO,e.x,e.y,e.z]},S=function(e){return[i.ORIENTATION,e.x,e.y,e.z,e.w]},A=function(e){return[i.DPAD,e.horizontal,e.vertical]},R=function(e){return[i.SLIDER,e.value,e.id,e.isDown?!0:!1]};!function(){o[i.PACKET]=E,o[i.ADDRESS]=m,o[i.PARAMETER]=y,o[i.INVOKE]=I,o[i.ACCELERATION]=b,o[i.TOUCH_SET]=C,o[i.ACK]=h,o[i.PING]=d,o[i.SHAKE]=l,o[i.BYTE_CHUNK]=f,o[i.TAGGED_ARRAY]=g,o[i.REGISTRY_INFO]=p,o[i.GYRO]=w,o[i.ORIENTATION]=S,o[i.DPAD]=A,o[i.SLIDER]=R,o[i.DEVICE_IPHONE]=u,o[i.DEVICE_UNITY]=u,o[i.DEVICE_ANDROID]=u,o[i.DEVICE_NATIVE]=u,o[i.DEVICE_PALM]=u,o[i.DEVICE_FLASH]=u}(),t.exports={createHandshake:function(e,t){return[c(e),c(t)]},generateControlChunks:function(e){return a(e,"testXML")},generateUpdateChunks:function(e){return a(e,"updateXML")},encodeObject:v,encodePacket:E}},{"../enum/encoding-type":30,"../environment/index":34}],26:[function(e,t,n){"use strict";t.exports={BROADCAST:0,ACCELERATION:1,TOUCH:2,MESSAGE:3,SHAKE:4,BYTE:5,GYRO:6,ORIENTATION:7,DPAD:8,SLIDER:9}},{}],27:[function(e,t,n){"use strict";var i="gamepad",r="keyboard",o="navigation",s="wait",c="html",a=[i,r,o,s,c];t.exports={GAMEPAD:i,KEYBOARD:r,NAVIGATION:o,WAIT:s,HTML:c,index:function(e){return a.indexOf(e)},value:function(e){return e=0>e?0:e,e=e>a.length-1?a.length-1:e,a[e]},isValid:function(e){return this.index(e)>-1}}},{}],28:[function(e,t,n){"use strict";t.exports={ANY:0,UNITY:1,IPHONE:2,FLASH:3,ANDROID:4,NATIVE:5}},{}],29:[function(e,t,n){"use strict";t.exports={DEAD:0,UP:-1,DOWN:1,LEFT:-1,RIGHT:1}},{}],
30:[function(e,t,n){"use strict";t.exports={PACKET:0,ADDRESS:1,PARAMETER:3,INVOKE:4,ACCELERATION:5,TOUCH_SET:6,DEVICE_IPHONE:7,DEVICE_UNITY:8,DEVICE_ANDROID:10,DEVICE_NATIVE:15,DEVICE_PALM:16,DEVICE_SERVER:17,DEVICE_FLASH:18,ACK:9,PING:11,SHAKE:13,BYTE_CHUNK:14,REGISTRY_INFO:19,TAGGED_ARRAY:21,GYRO:22,ORIENTATION:23,DPAD:24,SLIDER:25}},{}],31:[function(e,t,n){"use strict";t.exports={ERROR:0,APPLICATION_ID_REQUIRED:1,RUNTIME_FAILURE:2,REGISTER_FAILURE:3}},{}],32:[function(e,t,n){"use strict";t.exports={DATA:0,PING:1,ACK:2,ECHO:3,ANALYSIS:4,KEEP_ALIVE:5}},{}],33:[function(e,t,n){"use strict";var i=e("../../lib/base64"),r=!1,o=/^data:image\/(png|jpeg|jpg)\;base64\,/i;if("btoa"in window){var s=i.encode;i.encode=function(e){try{return[e.length,window.btoa(e)]}catch(t){return s(e)}}}t.exports={globalName:"red5prosecondscreenhost"+Math.floor(16777215*Math.random()*16777215).toString(16),exposeNoConflict:function(e){var t,n=function(){return"undefined"!=typeof t&&(window.secondscreenHost=t),e};"secondscreenHost"in window?t=window.secondscreenHost:(e.noConflict=n,window.secondscreenHost=e)},defineGlobalTarget:function(e){window[this.globalName]=e},getGlobalTarget:function(){return window[this.globalName]},getLocationSearch:function(){return document.location.search},getUserAgent:function(){return navigator.userAgent},getAppName:function(){return navigator.appName},loadComplete:function(){return"complete"===document.readyState||"interactive"===document.readyState},addLoadListener:function(e){window.addEventListener?window.addEventListener("DOMContentLoaded",e,!1):window.attachEvent("onload",e)},addUnloadListener:function(e){window.addEventListener?window.addEventListener("beforeunload",e,!1):window.attachEvent("onbeforeunload",e)},injectScript:function(e,t){var n=document.createElement("script");n.type="text/javascript",n.onload=t,n.onreadystatechange=function(){("loaded"===n.readyState||"complete"===n.readyState)&&(n.onreadystatechange=null,t())},n.src=e,document.getElementsByTagName("head")[0].appendChild(n)},getSwfObject:function(){return window.swfobject},createElement:function(e){return document.createElement(e)},getElement:function(e){return document.getElementById(e)},appendElementToBody:function(e){document.body.appendChild(e)},appendElementToContainer:function(e,t){t.appendChild(e)},loadImage:function(e,t,n){var i=this,r=function(t){var i=t.replace(o,"");n({data:i,width:s.width,height:s.height,url:e})},s=new Image;s.onload=function(){var e=i.createElement("canvas"),t=e.getContext("2d");e.width=s.width,e.height=s.height,t.drawImage(s,0,0),r(e.toDataURL())},s.onerror=t,s.src=e},supportsWebSockets:function(){return!r&&"WebSocket"in window},supportsBTOAEncoding:function(){return"btoa"in window},base64Encode:function(e){return i.encode(e)},createWebSocket:function(e){return new WebSocket(e)},getAbsoluteUrl:function(e){var t=document.createElement("img");return t.src=e,e=t.src,t.src=null,e},forceFlash:function(){r=!0}}},{"../../lib/base64":1}],34:[function(e,t,n){(function(n){var i=n.browser;i?t.exports=e("./browser"):t.exports=e("./node")}).call(this,e("_process"))},{"./browser":33,"./node":35,_process:8}],35:[function(e,t,n){(function(n,i){"use strict";var r=e("fs"),o=e("image-size"),s=e("websocket").client,c=e("../util/bind"),a={appCodeName:"Mozilla",appName:"Netscape",appVersion:"5.0 (iPhone; CPU iPhone OS 5_1 like Mac OS X) AppleWebKit/534.46 (KHTML, like Gecko) Version/5.1 Mobile/9B179 Safari/7534.48.3",language:"en-us",platform:"MacIntel",product:"Gecko",productSub:"20030107",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 5_1 like Mac OS X) AppleWebKit/534.46 (KHTML, like Gecko) Version/5.1 Mobile/9B179 Safari/7534.48.3",vendor:"Apple Computer, Inc."},u={},h={send:function(){},close:function(){},onopen:function(){},onmessage:function(){},onclose:function(){},onerror:function(){}},d=function(e){this.connection=void 0,this.socket=new s,this.onopen=c(this.onopen,this),this.onerror=c(this.onerror,this),this.onclose=c(this.onclose,this),this.onmessage=c(this.onmessage,this),function(t,n){n.on("connect",function(e){t.connection=e,function(e,n,i){for(var r=i.length;--r>-1;)!function(t){n.on(t,e["on"+t])}(i[r]);n.on("message",function(e){t.onmessage({data:e.utf8Data})}),n.on("error",function(e){t.onerror({error:e.toString()})})}(t,e,["open","close"]),t.onopen()}),n.on("connectFailed",function(e){t.onerror({error:e.toString()})}),n.connect(e)}(this,this.socket)};d.prototype={send:function(){this.connection.send.apply(this.connection,Array.prototype.slice.call(arguments))},close:function(){this.connection.close.apply(this.connection,Array.prototype.slice.call(arguments))},onopen:function(){},onerror:function(){},onclose:function(){},onmessage:function(){}},t.exports={globalName:"red5-pro-secondscreen-host",exposeNoConflict:function(e){return e},defineGlobalTarget:function(e){u[this.globalName]=e},getGlobalTarget:function(){return u[this.globalName]},getLocationSearch:function(){return{split:function(){return[]}}},getUserAgent:function(){return a.userAgent},getAppName:function(){return a.appName},loadComplete:function(){return!0},addLoadListener:function(e){var t=setTimeout(function(){clearTimeout(t),e()},100)},addUnloadListener:function(){},injectScript:function(){},getSwfObject:function(){return void 0},createElement:function(){return{style:{}}},getElement:function(){return{}},appendElementToBody:function(){},appendElementToContainer:function(){},loadImage:function(e,t,n){var s,c,a;o(e,function(o,u){o?t(o):(c=u.width,a=u.height,r.readFile(e,function(r,o){r?t(r):(s=new i(o,"binary").toString("base64"),n({data:s,width:c,height:a,url:e}))}))})},supportsWebSockets:function(){return!0},supportsBTOAEncoding:function(){return!1},base64Encode:function(e){return[e.length,new i(e).toString("base64")]},createWebSocket:function(e){if(n.test)return Object.create(h);try{return new d(e)}catch(t){throw t}},getAbsoluteUrl:function(e){return e},forceFlash:function(){}}}).call(this,e("_process"),e("buffer").Buffer)},{"../util/bind":43,_process:8,buffer:3,fs:2,"image-size":9,websocket:10}],36:[function(e,t,n){"use strict";var i=e("../struct/base-classes"),r={DEVICE_CONN_REQUEST:"connectrequest",REGISTRY_DISCONNECT:"registrydisconnect",SHOW_SLOT_COLOR:"showslotcolor",CONNECTION_MESSAGE:"connectionmessage",DEVICE_MESSAGE:"devicemessage"},o={ADD_DEVICE:"adddevice",REMOVE_DEVICE:"removedevice",DEVICE_ERROR:"deviceerror",CONTROL_SCHEME:"controlscheme",SEND_PORTAL_ID:"sendportalid",SET_CAPABILITIES:"setcapabilities",DEVICE_CONNECTED:"deviceconnected",DEVICE_DISCONNECTED:"devicedisconnected",DEVICE_CONN_ERROR:"deviceconnecterror",FLASH_RUNTIME_LOADED:"flashruntimeloaded"},s={PAUSE:"pause",WAIT_CANCELLED:"waitcancelled",NAVIGATION:"navstring",KEYBOARD:"keyboard",BUTTON_UP:"buttonup",BUTTON_DOWN:"buttondown",SHAKE:"shake",ACCELERATION:"acceleration",TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",GYROSCOPE:"gyroscope",ORIENTATION:"orientation",DPAD:"dpad",SLIDER:"slider",MESSAGE:"message",CONTROLS_URL_CHANGE:"controlsurlchange"},c=i.EventEmitter.extend({init:function(){this._super(),this.EventTypes=r,this.DeviceEventTypes=s,this.ConnectionEventTypes=o},triggerDeviceMessage:function(e,t){this.trigger(this.EventTypes.DEVICE_MESSAGE,{type:e,data:t})},triggerConnectionMessage:function(e,t){this.trigger(this.EventTypes.CONNECTION_MESSAGE,{type:e,data:t})}});t.exports=new c},{"../struct/base-classes":42}],37:[function(e,t,n){"use strict";var i="log",r="info",o="debug",s="warn",c="error",a="none",u=0,h=[i,r,o,s,c],d=function(e){var t,n=16;if(e.length>n)t=e.substr(0,n-1);else for(t=e;t.length<n-1;)t+=" ";return t},l=function(e){this.name=d(e)};l.prototype.format=function(e,t){var n=new Date,i=n.getHours()+":"+n.getMinutes()+":"+n.getSeconds()+":"+n.getMilliseconds();return"-"+this.name+"- "+i+" ["+e.toUpperCase()+"] :: "+t},l.prototype.print=function(e,t){var n=h.indexOf(e);0===n?console.log(this.format(e,t)):n>=u&&console[e](this.format(e,t))},function(e,t){for(var n=e.length;--n>-1;)!function(e){t[e]=function(t){this.print.call(this,e,t)}}(e[n])}(h,l.prototype),t.exports={LogLevels:{LOG:i,INFO:r,DEBUG:o,WARN:s,ERROR:c,NONE:a},setLogLevel:function(e){var t=h.indexOf(e);t>-1?u=t:e===a&&(u=h.length)},getLogger:function(e){return new l(e)}}},{}],38:[function(e,t,n){var i=e("../struct/base-classes"),r=e("../event/bridge"),o=e("../device/device-factory"),s=e("../device/flash-channel-responder"),c=e("../browser/detection"),a=e("../browser/plugin/flash-util"),u=e("../util/bind"),h=e("../util/resource-util"),d=e("../log/logger"),l=e("../enum/control-mode-type"),f=r.EventTypes,g=r.ConnectionEventTypes,p=d.getLogger("Flash Runtime"),v=function(e){var t=e.options.design;if("string"==typeof t)a.initializeFlashObject([],e);else if(-1!==c.detectInternetExplorerVersion())p.warn("IE version detected that does not allow Image preloading."),a.initializeFlashObject([],e);else if("object"==typeof t){var n=t.images?t.images:[];n&&0===n.length?a.initializeFlashObject(n,e):(p.info("Loading resource image before initalizing object embed..."),h.loadImages(n,function(t){a.initializeFlashObject(t,e)}))}},E=i.Class.extend({init:function(){this.flashObjID=Math.floor(16777215*Math.random()*16777215).toString(16),this.handleConnectionMessage=u(this.handleConnectionMessage,this),this.handleDeviceConnectRequest=u(this.handleDeviceConnectRequest,this),this.responder=s.create(),this.pendingConnections=[],this.pending=!1},start:function(e){var t;return e.flashObjID=this.flashObjID,this.config=e,this.pending=!0,t=this.config._success,function(e){e.config._success=function(){e.pending=!1,t.apply(e.config,arguments)}}(this),p.info("Starting Flash Runtime instance as Host Runtime."),p.info("FlashObjectId: "+e.flashObjID),p.info("SWF file to load: "+e.options.swfUrl),r.on(f.CONNECTION_MESSAGE,this.handleConnectionMessage),r.on(f.DEVICE_CONN_REQUEST,this.handleDeviceConnectRequest),c.onLoad(v,this.config),this},stop:function(){return p.info("Stopping Flash Runtime instance as Host Runtime."),this.getFlashObject().stop(),this.config=void 0,this.responder.unregisterAll(),r.off(f.CONNECTION_MESSAGE,this.handleConnectionMessage),r.off(f.DEVICE_CONN_REQUEST,this.handleDeviceConnectRequest),this},getPendingConnectionIndex:function(e){for(var t=this.pendingConnections.length;--t>-1;)if(this.pendingConnections[t].id===e.id)return t;return-1},addPendingConnection:function(e){var t=this.getPendingConnectionIndex(e);-1===t&&(this.pendingConnections.push(e),this.responder.register(e))},removePendingConnection:function(e){var t=this.getPendingConnectionIndex(e);t>-1&&this.pendingConnections.splice(t,1)},addConnection:function(e){this.removePendingConnection(e)},removeConnection:function(e){this.responder.unregister(e)},setVisibility:function(e){var t=this.getFlashObject();if(void 0!==t)try{t.SetVisibility(e,!0)}catch(n){}},getFlashObject:function(){return a.getFlashObjectById(this.flashObjID)},handleConnectionMessage:function(e){e.type===g.FLASH_RUNTIME_LOADED?(p.info("Flash Runtime Embedded and Loaded."),this.responder.target=this.getFlashObject()):e.type===g.ADD_DEVICE?this.addConnection(e.data.device):e.type===g.REMOVE_DEVICE&&this.removeConnection(e.data.device)},handleDeviceConnectRequest:function(e){var t,n=e.deviceId,i=e.deviceName,r=l.value(e.controlMode);t=o.createBridgeConnection(i,n,r,this.config,this.getFlashObject()),this.addPendingConnection(t)}});t.exports={Runtime:E}},{"../browser/detection":13,"../browser/plugin/flash-util":14,"../device/device-factory":18,"../device/flash-channel-responder":20,"../enum/control-mode-type":27,"../event/bridge":36,"../log/logger":37,"../struct/base-classes":42,"../util/bind":43,"../util/resource-util":48}],39:[function(e,t,n){"use strict";var i=e("./flash"),r=e("./websockets"),o=e("../environment/index"),s={FLASH:0,WEBSOCKETS:1};t.exports={RuntimeTypes:s,getRuntimeType:function(){return o.supportsWebSockets()?s.WEBSOCKETS:s.FLASH},getRuntime:function(e){return this.getRuntimeType()===s.WEBSOCKETS?new r.Runtime(e):new i.Runtime(e)}}},{"../environment/index":34,"./flash":38,"./websockets":40}],40:[function(e,t,n){"use strict";var i=e("../struct/base-classes"),r=e("../event/bridge"),o=e("../util/bind"),s=e("../connection/registry"),c=e("../device/device-factory"),a=e("../util/resource-util"),u=e("../log/logger"),h=e("../enum/encoding-type"),d=e("../enum/device-type"),l=e("../enum/error-type"),f=r.EventTypes,g=r.ConnectionEventTypes,p=0,v=i.Class.extend({init:function(){this.id=++p,this.hostDevice={id:void 0,name:void 0,type:d.FLASH,encodeType:h.DEVICE_FLASH},this.hostAddress={hostname:"unknown",udpPort:0,tcpPort:0,encodeType:h.ADDRESS},this.registry=void 0,this.config=void 0,this.connections=[],this.pendingConnections=[],this.pending=!1,this.logger=u.getLogger("WebSockets Runtime")},start:function(e){this.config=e,this.hostDevice.name=this.config.options.name,this.hostDevice.id=this.config.options.deviceId,this.handleConnectionMessage=o(this.handleConnectionMessage,this),this.handleDeviceConnectRequest=o(this.handleDeviceConnectRequest,this),a.preloadDesignImages(this.config.options.design),r.on(f.CONNECTION_MESSAGE,this.handleConnectionMessage),r.on(f.DEVICE_CONN_REQUEST,this.handleDeviceConnectRequest),this.logger.info("Starting Websockets Runtime with host id "+this.hostDevice.id);try{this.registry=s.createWebSocketRegistry(this.config),this.registry.start()}catch(t){throw new Error({type:l.RUNTIME_FAILURE,message:t.message})}return this},stop:function(){for(this.logger.info("Stopping WebSockets Runtime with host id "+this.hostDevice.id);this.connections.length>0;)this.removeConnection(this.connections.shift());return this.connections.length=0,this.registry.stop(),this.config=void 0,r.off(f.CONNECTION_MESSAGE,this.handleConnectionMessage),r.off(f.DEVICE_CONN_REQUEST,this.handleDeviceConnectRequest),this},setVisibility:function(e){this.registry.setVisibility(e)},hasReachMaxConnections:function(){return this.connections.length>=this.config.options.maxPlayers},connectionAlreadyRegistered:function(e){for(var t=this.connections.length;--t>-1;)if(this.connections[t].id===e)return!0;return!1},getPendingConnectionIndex:function(e){for(var t=this.pendingConnections.length;--t>-1;)if(this.pendingConnections[t].id===e.id)return t;return-1},addPendingConnection:function(e){var t=this.getPendingConnectionIndex(e);-1===t&&this.pendingConnections.push(e)},removePendingConnection:function(e){var t=this.getPendingConnectionIndex(e);t>-1&&this.pendingConnections.splice(t,1)},addConnection:function(e){this.connections.push(e),this.removePendingConnection(e),this.registry.setPlayerCount(this.connections.length),this.logger.info("Adding connection to Host Runtime...")},removeConnection:function(e){var t=this.connections.indexOf(e);t>-1&&(this.logger.info("Removing connection from Host Runtime..."),this.connections.splice(t,1),this.registry.setPlayerCount(this.connections.length))},handleConnectionMessage:function(e){this.logger.info("Message received form connection device. Event: "+e.type+", device id: "+e.data.device.id),e.type===g.ADD_DEVICE?this.addConnection(e.data.device):e.type===g.REMOVE_DEVICE&&this.removeConnection(e.data.device)},handleDeviceConnectRequest:function(e){var t,n,i=e.device.deviceId,r=e.device.deviceName,o=e.address;this.logger.info("Attempting to connection to device "+i),this.hasReachMaxConnections()?this.logger.warn("Maximium connections already reached. Not connecting to "+i+"."):this.connectionAlreadyRegistered(i)?this.logger.warn("Already connected to "+i+"."):(t="ws://"+o.host+":"+o.reliablePort,this.logger.info("Request to connect to device at "+t+"."),n=c.createDeviceConnection(r,i,this.config),n.connect(t,this.hostDevice,this.hostAddress),this.addPendingConnection(n))}});t.exports={Runtime:v}},{"../connection/registry":15,"../device/device-factory":18,"../enum/device-type":28,"../enum/encoding-type":30,"../enum/error-type":31,"../event/bridge":36,"../log/logger":37,"../struct/base-classes":42,"../util/bind":43,"../util/resource-util":48}],41:[function(e,t,n){"use strict";var i=e("./struct/base-classes"),r=e("./log/logger"),o=e("./event/bridge"),s=e("./device/device-factory"),c=e("./runtime/runtime-factory"),a=e("./util/bind"),u=e("./util/proxy"),h=e("./environment/index"),d=e("./enum/error-type"),l=e("./enum/control-mode-type"),f=o.EventTypes,g=o.ConnectionEventTypes,p=o.DeviceEventTypes,v=e("./enum/dpad-controls"),E="0.7.0",m="none",y=!0,I={name:"Red5 Pro SecondScreen Host",maxPlayers:1,registryAddress:"10.0.0.1",appId:"secondscreen",swfUrl:"swf/secondscreenHost.swf",swfobjectUrl:"swf/swfobject.js",minimumVersion:{major:0,minor:0},design:{orientation:"portrait",touchEnabled:!1,accelerometerEnabled:!1,preload:[],layout:[],images:[]},error:function(){},success:function(){},_error:function(){this.error&&this.error.apply(null,Array.prototype.slice.call(arguments))},_success:function(){this.success&&this.success.apply(null,Array.prototype.slice.call(arguments))}},b=function(e,t){var n;for(n in e)t[n]=e[n];return t},C=function(e){var t,n={},i=/[?&]?([^=]+)=([^&]*)/g;for(e=e.split("+").join(" ");t=i.exec(e);)n[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return n},w=function(){return Math.floor(16777215*Math.random()*16777215).toString(16)},S=function(e,t,n){e.hasOwnProperty(t)&&!n.hasOwnProperty(t)?n[t]=e[t]:e[t]=n[t]},A=function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},R=function(){return A({SHOW_SLOT_COLOR:f.SHOW_SLOT_COLOR,REGISTRY_DISCONNECT:f.REGISTRY_DISCONNECT},A(p,g))},D=["#ff6600","#ffcc00","#ff3399","#ff0066","#cc00ff","#999900","#9999cc","#00cc99","#287200","#00ccff","#003366","#99ff00","#cc0000","#80cd68","#6600ff"],T=0,_=i.EventEmitter.extend({init:function(){var e;this._super(),this.uid=++T,e=C(h.getLocationSearch()),this.appId=e.appId,this.portalId=e.portalId,this.deviceId=e.appId||w(),this.version=E,this.devices={},this.runtime=void 0,this.config={options:I},this.log=r.getLogger("Red5 Pro SecondScreen Host"),this.handleShowSlotColor=a(this.handleShowSlotColor,this),this.handleDeviceMessage=a(this.handleDeviceMessage,this),this.handleConnectionMessage=a(this.handleConnectionMessage,this),this.handleRegistryDisconnect=a(this.handleRegistryDisconnect,this)},addEventHandlers:function(){this.removeEventHandlers(),o.on(f.DEVICE_MESSAGE,this.handleDeviceMessage),o.on(f.SHOW_SLOT_COLOR,this.handleShowSlotColor),o.on(f.CONNECTION_MESSAGE,this.handleConnectionMessage),o.on(f.REGISTRY_DISCONNECT,this.handleRegistryDisconnect)},removeEventHandlers:function(){o.off(f.DEVICE_MESSAGE,this.handleDeviceMessage),o.off(f.SHOW_SLOT_COLOR,this.handleShowSlotColor),o.off(f.CONNECTION_MESSAGE,this.handleConnectionMessage),o.off(f.REGISTRY_DISCONNECT,this.handleRegistryDisconnect)},start:function(e,t){if("undefined"!=typeof e&&(this.config.options=b(e,this.config.options)),S(this,"appId",this.config.options),S(this,"portalId",this.config.options),S(this,"deviceId",this.config.options),!this.config.options.appId){var n="A proper application id is required for Red5 Pro SecondScreenHost. Provided application id: "+this.config.options.appId;throw this.log.error(n),this.config.options._error(d.APPLICATION_ID_REQUIRED,n),new Error({type:d.APPLICATION_ID_REQUIRED,message:n})}this.appId=this.config.options.appId,"undefined"!=typeof t&&t&&h.forceFlash();try{this.log.info(this.versionStr()),h.addUnloadListener(a(this.stop,this)),this.runtime=c.getRuntime().start(this.config),this.runtime.pending||this.config.options._success(),this.addEventHandlers(),this.log.info("Started with appId "+this.config.options.appId)}catch(i){throw this.removeEventHandlers(),this.config.options._error(i.type,"Could not start SecondScreenHost Runtime: "+i.message+"."),new Error(i)}},stop:function(){var e;this.log.info("Stopping SecondScreenHost instance with appId "+this.config.options.appId),"undefined"!=typeof this.runtime&&this.runtime.stop();for(e in this.devices)this.removeDeviceById(e);this.runtime=void 0,this.removeEventHandlers()},getDeviceById:function(e){return this.devices.hasOwnProperty(e)?this.devices[e]:void 0},allDevices:function(){return function(){return u.initializeWithMap(this.devices,s.getProxyMethods())}}(),setVisibility:function(e){y!==e&&(y=e,"undefined"!=typeof this.runtime&&(this.log.info("Setting visibility on runtime to "+e+"."),this.runtime.setVisibility(y)))},getVisibility:function(){return y},addDevice:function(e){this.log.info("Request to add device "+e.id+"."),this.devices[e.id]=e,this.trigger(g.DEVICE_CONNECTED,{device:e})},removeDeviceById:function(e){var t;this.log.info("Request to remove device "+e+"."),this.getDeviceById(e)?(t=this.devices[e],t.close(),this.log.info("Removing device "+e+"."),delete this.devices[e],this.trigger(g.DEVICE_DISCONNECTED,{device:t})):this.log.warn("Could not find device in list: "+e+".")},versionStr:function(){return"Red5 Pro Second Screen HTML Host :) Version "+this.version},setLogLevel:function(e){r.setLogLevel(e)},handleShowSlotColor:function(e){var t=e.data.slot,n=Math.max(0,t-1)%D.length,i=D[n];this.log.info("Show Slot Color for id "+t+", color: "+i),this.trigger(e.type,{slot:t,color:i})},handleRegistryDisconnect:function(e){this.log.info("Registry disconnection recieved."),this.trigger(e.type)},handleConnectionMessage:function(e){this.log.info("Event receieved on Connection for device "+e.data.device.id+": "+e.type),e.type===g.ADD_DEVICE?this.addDevice(e.data.device):e.type===g.REMOVE_DEVICE&&this.removeDeviceById(e.data.device.id),this.trigger(e.type,e.data)},handleDeviceMessage:function(e){this.log.info("Event receieved on Device for device "+e.data.device.id+": "+e.type),this.trigger(e.type,e.data)}}),O=new _;O.ErrorTypes=d,O.EventTypes=R(),O.ControlModes=l,O.LogLevels=r.LogLevels,O.SlotColors=D,O.DPadControls=v,r.setLogLevel(m),h.exposeNoConflict(O),t.exports=O},{"./device/device-factory":18,"./enum/control-mode-type":27,"./enum/dpad-controls":29,"./enum/error-type":31,"./environment/index":34,"./event/bridge":36,"./log/logger":37,"./runtime/runtime-factory":39,"./struct/base-classes":42,"./util/bind":43,"./util/proxy":47}],42:[function(e,t,n){function i(){}var r=!1,o=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;i.extend=function(e){function t(){!r&&this.init&&this.init.apply(this,arguments)}var n=this.prototype;r=!0;var i=new this;r=!1;for(var s in e)i[s]="function"==typeof e[s]&&"function"==typeof n[s]&&o.test(e[s])?function(e,t){return function(){var i=this._super;this._super=n[e];var r=t.apply(this,arguments);return this._super=i,r}}(s,e[s]):e[s];return t.prototype=i,t.prototype.constructor=t,t.extend=arguments.callee,t},EventEmitter=i.extend({init:function(){this.callbacks={}},addEventListener:function(e,t){if("function"!=typeof t)throw new Error(".on() callback provided was not a function");void 0===this.callbacks[e]&&(this.callbacks[e]=[]),-1===this.getIndexOfFunctionByType(e,t)&&this.callbacks[e].push(t)},on:function(e,t){this.addEventListener(e,t)},removeEventListener:function(e,t){if(void 0!==this.callbacks[e]){var n=this.callbacks[e],i=this.getIndexOfFunctionByType(e,t);i>-1&&n.splice(i,1)}},getIndexOfFunctionByType:function(e,t){if(void 0!==this.callbacks[e]){var n,i=this.callbacks[e];for(n=0;n<i.length;n++)if(i[n]==t)return n;return-1}return-1},off:function(e,t){this.removeEventListener(e,t)},trigger:function(e,t){if(void 0!==this.callbacks[e])for(var n,i=this.callbacks[e],n=0;n<i.length;n++)i[n](t)},triggerWithType:function(e,t){t.type=e,this.trigger(e,t)}}),t.exports={Class:i,EventEmitter:EventEmitter}},{}],43:[function(e,t,n){"use strict";t.exports=function(e,t){return function(){return e.apply(t,arguments)}}},{}],44:[function(e,t,n){"use strict";t.exports=function(e,t,n){var i,r=function(){clearTimeout(i),e.apply(n,arguments)};return function(){clearTimeout(i),i=setTimeout(r,t,arguments)}}},{}],45:[function(e,t,n){"use strict";var i=e("../struct/base-classes"),r=e("../environment/index"),o=i.Class.extend({init:function(){this.store={},this.indexStore=[]},setCache:function(e,t){this.store[e]=t,this.indexStore.push(e)},getCache:function(e){return this.store.hasOwnProperty(e)?this.store[e]:void 0},getResourceId:function(e){return"undefined"==typeof e?-1:this.indexStore.indexOf(e)+1}}),s=i.Class.extend({init:function(e,t,n){this.store=e,this.imageUrls=t||[],this.imageData=[],this.queue=[],this.callback=n},_load:function(e){!function(t){r.loadImage(e,function(){t.next()},function(n){t.imageData.push(n),t.store.setCache(e,n),t.next()})}(this)},start:function(){var e,t,n,i=this.imageUrls.length;for(e=0;i>e;e++)t=this.imageUrls[e],n=this.store.getCache(t),n?this.imageData.push(n):this.queue.push(t);this.next()},next:function(){this.queue.length>0?this._load(this.queue.shift()):this.callback&&this.callback.call(null,this.imageData)}}),c=new o;t.exports={loadImages:function(e,t){new s(c,e,t).start()},getCacheFromUrl:function(e){return c.getCache(e)},getResourceIdFromUrl:function(e){return c.getResourceId(e)}}},{"../environment/index":34,"../struct/base-classes":42}],46:[function(e,t,n){"use strict";t.exports={toJSON:function(e){try{return JSON.parse(decodeURIComponent(e))}catch(t){}return void 0}}},{}],47:[function(e,t,n){"use strict";var i=function(e){this.objectMap=e},r=function(e,t){return function(){var n=Array.prototype.slice.call(arguments);e.execute.apply(e,[t].concat(n))}};i.prototype={execute:function(){var e,t,n=arguments[0],i=Array.prototype.slice.call(arguments).slice(1);for(e in this.objectMap)t=this.objectMap[e],t[n].apply(t,i);return this}},t.exports={initializeWithMap:function(e,t){var n,o,s=new i(e),c=t.length;for(n=0;c>n;n++)o=t[n],s[o]=r(s,o);return s}}},{}],48:[function(e,t,n){"use strict";var i=e("./image-cache-resource"),r=function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n},o=function(e,t){"undefined"!=typeof e&&-1===t.indexOf(e)&&(t[t.length]=e)},s=function(e){var t,n,i,r,s=e.layout;if(void 0!==s){for(n=s.length,r=e.__resources__||(e.preload?e.preload.slice():[]),t=0;n>t;t++)i=s[t],"image"===i.type?o(i.src,r):"button"===i.type?(o(i.srcUp,r),o(i.srcDown,r)):"slider"===i.type&&(o(i.srcUp,r),o(i.srcDown,r),o(i.srcBackground,r));return e.__resources__=r,r}},c=function(e){var t="",n=e.src||e.srcUp,r=e.srcDown,o=e.srcBackground,s=i.getResourceIdFromUrl(n)||-1,c=i.getResourceIdFromUrl(r)||-1,a=i.getResourceIdFromUrl(o)||-1;return"image"===e.type?t+='<Asset name="up" resourceRef="'+s+'" />':"button"===e.type?(t+='<Asset name="up" resourceRef="'+s+'" />',t+='<Asset name="down" resourceRef="'+c+'" />'):"slider"===e.type&&(t+='<Asset name="up" resourceRef="'+s+'" />',t+='<Asset name="down" resourceRef="'+c+'" />',t+='<Asset name="background" resourceRef="'+a+'" />'),t},a=function(e,t,n){var r,o=e.src||e.srcUp,s=i.getCacheFromUrl(o),a=i.getResourceIdFromUrl(o)||-1;return e.x=void 0===e.x?0:e.x,e.y=void 0===e.y?0:e.y,void 0===e.width&&void 0!==s&&(e.width=s.width),void 0===e.height&&void 0!==s&&(e.height=s.height),r='<DisplayObject type="'+e.type+'" top="'+e.y/n+'" left="'+e.x/t+'" width="'+e.width/t+'" height="'+e.height/n+'" id="'+a+'" ',"button"===e.type&&e.id?r+='functionHandler="'+e.id+'" ':"slider"===e.type&&(r+='sliderId="'+e.sliderId+'" ',r+='orientation="'+(e.orientation?e.orientation.toLowerCase():"horizontal")+'" ',r+='handleWidth="'+e.handleWidth/t+'" ',r+='handleHeight="'+e.handleHeight/n+'" '),e.text&&(r+='text="'+e.text+'" textSize="'+Number(e.textSize)/n+'" '),void 0!==e.color&&(r+='color="'+e.color+'" '),e.hidden&&(r+='hidden="yes" '),r+=">",r+=c(e),r+="</DisplayObject>"},u=function(e){var t,n=e.layout,i=e.width,r=e.height,o=n?n.length:0,s="<Layout/>",c=[];if(o>0){for(c.push("<Layout>"),t=0;o>t;t++)c.push(a(n[t],i,r));c.push("</Layout>"),s=c.join("\n")}return s},h=function(e,t){var n,r,o=t.length,s=["<Resources>"];for(n=0;o>n;n++)r=t[n],s.push('<Resource id="'+i.getResourceIdFromUrl(r.url)+'" type="image"><data><![CDATA['+r.data+"]]></data></Resource>");return s.push("</Resources>"),s.join("\n")},d=function(e,t){var n;return"portrait"===e.orientation?(e.width=320,e.height=480):(e.width=480,e.height=320),n='<?xml version="1.0" encoding="utf-8"?>\n<BMApplicationScheme version="0.1" orientation="'+e.orientation+'" touchEnabled="'+(e.touchEnabled?"yes":"no")+'" accelerometerEnabled="'+(e.accelerometerEnabled?"yes":"no")+'">\n',n+=h(e,t),n+=u(e),n+="</BMApplicationScheme>"};t.exports={cloneDesign:function(e){for(var t=r(e),n=e.layout,i=n?n.length:0,o=new Array(i);--i>-1;)o[i]=r(n[i]);return t.__resources__&&(t.__resources__=t.__resources__.slice()),t.layout=o,t},preloadDesignImages:function(e){i.loadImages(s(e))},generateControllerXML:function(e,t){i.loadImages(s(e),function(n){t&&t.call(null,d(e,n))})},generateUpdateXML:function(e){return"<BMApplicationScheme>"+u(e)+"</BMApplicationScheme>"}}},{"./image-cache-resource":45}]},{},[41]);